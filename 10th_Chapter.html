<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICAB MCQ Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .quiz-container {
            max-width: 1400px;
            margin: auto;
        }
        .tracker-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .tracker-btn.unattempted { background-color: #e2e8f0; color: #4a5568; }
        .tracker-btn.attempted { background-color: #c6f6d5; color: #2f855a; }
        .tracker-btn.flagged { background-color: #feebc8; color: #975a16; }
        .tracker-btn.current { background-color: #3b82f6; color: white; border: 2px solid #2563eb; }
        .option-label {
            display: block;
            padding: 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option-label:hover {
            background-color: #f7fafc;
            border-color: #a0aec0;
        }
        .option-label.selected {
            background-color: #ebf8ff;
            border-color: #4299e1;
        }
        .option-label.correct {
            background-color: #c6f6d5;
            border-color: #38a169;
        }
        .option-label.incorrect {
            background-color: #fed7d7;
            border-color: #e53e3e;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #e2e8f0;
            color: #2d3748;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #cbd5e1;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="app" class="quiz-container p-4 md:p-8">

        <!-- Home Screen -->
        <div id="home-screen" class="text-center bg-white p-8 rounded-xl shadow-lg">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-700">ICAB - Certificate Level</h1>
            <h2 class="text-xl md:text-2xl font-semibold text-gray-600 mt-2">Subject: Accounting</h2>
            <p class="text-lg text-gray-500 mt-1">Chapter 10: Non-current assets, depreciation and impairment</p>
            <p class="mt-6 text-gray-600">You have <span class="font-bold">45 minutes</span> to complete <span class="font-bold">50 questions</span>.</p>
            <button id="start-quiz-btn" class="btn-primary mt-8 text-xl">Start Quiz</button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Left Side: Tracker -->
                <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-full">
                    <h3 class="text-lg font-bold mb-4 text-center">Question Tracker</h3>
                    <div id="question-tracker" class="grid grid-cols-5 gap-3">
                        <!-- Tracker buttons will be generated here -->
                    </div>
                </div>

                <!-- Right Side: Question and Timer -->
                <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-lg flex flex-col h-full">
                    <div class="flex justify-between items-center border-b pb-4 mb-4">
                        <div class="flex items-center space-x-4">
                            <h2 class="text-2xl font-bold">Question <span id="question-number">1</span>/50</h2>
                            <span id="tricky-indicator" class="hidden text-yellow-500 font-bold">âš  Tricky</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button id="flag-btn" class="btn-secondary text-sm px-4 py-2">ğŸš© Flag This Question</button>
                            <div id="timer" class="text-2xl font-bold bg-gray-100 px-4 py-2 rounded-lg text-red-600">45:00</div>
                        </div>
                    </div>

                    <div id="question-container" class="flex-grow">
                        <p id="question-text" class="text-lg mb-6 leading-relaxed"></p>
                        <div id="options-container" class="space-y-4">
                            <!-- Options will be generated here -->
                        </div>
                    </div>

                    <div class="flex justify-between items-center mt-8 pt-4 border-t">
                        <button id="prev-btn" class="btn-secondary">Previous</button>
                        <button id="next-btn" class="btn-primary">Next</button>
                        <button id="submit-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Submit Quiz</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden bg-white p-8 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold text-center mb-6">Quiz Results</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Score Summary -->
                <div>
                    <h3 class="text-xl font-bold mb-4">Performance Summary</h3>
                    <div class="flex justify-around text-center">
                        <div>
                            <p class="text-4xl font-bold text-green-600" id="correct-percentage">0%</p>
                            <p class="text-gray-600">Correct</p>
                        </div>
                        <div>
                            <p class="text-4xl font-bold text-red-600" id="incorrect-percentage">0%</p>
                            <p class="text-gray-600">Incorrect</p>
                        </div>
                    </div>
                    <div class="mt-6">
                        <p class="text-lg">Total Questions: <span class="font-bold">50</span></p>
                        <p class="text-lg">Correct Answers: <span id="correct-count" class="font-bold text-green-600">0</span></p>
                        <p class="text-lg">Incorrect Answers: <span id="incorrect-count" class="font-bold text-red-600">0</span></p>
                        <p class="text-lg">Unattempted: <span id="unattempted-count" class="font-bold text-gray-600">0</span></p>
                    </div>
                </div>
                <!-- Gamification -->
                <div>
                    <h3 class="text-xl font-bold mb-4">Your Progress</h3>
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <span class="text-2xl mr-4">ğŸ’¡</span>
                            <div>
                                <p class="font-bold">Experience Points (XP)</p>
                                <p id="xp-earned" class="text-gray-600">You earned 0 XP!</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="text-2xl mr-4">ğŸ†</span>
                            <div>
                                <p class="font-bold">Badges Earned</p>
                                <p id="badges-earned" class="text-gray-600">None this time. Keep trying!</p>
                            </div>
                        </div>
                         <div class="flex items-center">
                            <span class="text-2xl mr-4">ğŸ“š</span>
                            <div>
                                <p class="font-bold">Chapter Coverage</p>
                                <p id="chapter-coverage" class="text-gray-600">You've been tested on key concepts from the chapter.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Topics to Review -->
            <div class="mt-8">
                <h3 class="text-xl font-bold mb-4">Topics to Review</h3>
                <div id="review-topics-list" class="space-y-2 text-red-700">
                    <!-- List will be populated here -->
                </div>
            </div>

            <div class="mt-8 text-center space-x-4">
                <button id="review-answers-btn" class="btn-secondary">Review Answers</button>
                <button id="try-again-btn" class="btn-primary">Try Again</button>
            </div>
        </div>

        <!-- Review Screen -->
        <div id="review-screen" class="hidden bg-white p-8 rounded-xl shadow-lg">
             <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Review Answers</h2>
                <button id="back-to-results-btn" class="btn-primary">Back to Results</button>
            </div>
            <div id="review-content" class="space-y-8 max-h-[70vh] overflow-y-auto no-scrollbar pr-4">
                <!-- Review questions will be populated here -->
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
            <div class="relative mx-auto p-8 border w-full max-w-md shadow-lg rounded-md bg-white">
                <div class="text-center">
                    <h3 id="modal-title" class="text-lg font-medium leading-6 text-gray-900">Confirm Submission</h3>
                    <div class="mt-2 px-7 py-3">
                        <p id="modal-text" class="text-sm text-gray-500"></p>
                    </div>
                    <div class="items-center px-4 py-3 space-x-4">
                        <button id="modal-confirm-btn" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md w-24 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            Yes
                        </button>
                        <button id="modal-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-900 text-base font-medium rounded-md w-24 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>Prepared by:</p>
            <p class="font-semibold">K. M. Mahafuzul Alam</p>
            <div class="flex justify-center items-center space-x-4 mt-2">
                <a href="https://www.linkedin.com/in/k-m-mahafuzul-alam" target="_blank" class="hover:text-blue-600">ğŸ”— LinkedIn</a>
                <span>|</span>
                <span>ğŸ“ 01728-928984</span>
                <span>|</span>
                <span>ğŸ“§ kmmhafuzulalam@gmail.com</span>
            </div>
        </footer>
    </div>

    <script>
        // --- DATA: QUESTIONS ---
        // This is a sample of 50 questions based on the provided PDF content.
        const questions = [
            // Topic 1: Tangible non-current assets and depreciation (IAS 16)
            {
                id: 1,
                question: "According to IAS 16, which of the following should be included in the cost of an item of Property, Plant, and Equipment (PPE)?",
                options: ["Administration costs", "Staff training costs", "Costs of testing whether the asset is functioning", "General overhead costs"],
                type: 'single',
                answer: "Costs of testing whether the asset is functioning",
                explanation: "IAS 16 specifies that only directly attributable costs to bring the asset to the location and condition for its intended use can be capitalized. Testing costs are a direct cost, while administration, training, and general overheads are not.",
                topic: "Cost of PPE (IAS 16)",
                isTricky: false
            },
            {
                id: 2,
                question: "A business purchases a new car for Â£20,000. The purchase price includes Â£3,000 of VAT which is irrecoverable. Delivery costs were Â£500 and a vehicle license fee was Â£200. What is the capitalised cost of the car?",
                options: ["Â£20,000", "Â£20,500", "Â£20,700", "Â£23,700"],
                type: 'single',
                answer: "Â£20,500",
                explanation: "The capitalised cost includes the purchase price (including irrecoverable VAT) and delivery costs. The license fee is an operating expense. Cost = Â£20,000 (price incl. VAT) + Â£500 (delivery) = Â£20,500.",
                topic: "Cost of PPE (IAS 16)",
                isTricky: false
            },
            {
                id: 3,
                question: "Which of the following are considered 'directly attributable costs' for an item of PPE? (Select all that apply)",
                options: ["Purchase price", "Costs of opening a new facility", "Costs of site preparation", "Professional fees (e.g., legal, architects)"],
                type: 'multiple',
                answer: ["Purchase price", "Costs of site preparation", "Professional fees (e.g., legal, architects)"],
                explanation: "Purchase price, site preparation, and professional fees are directly related to acquiring and preparing the asset. Costs of opening a new facility are general business costs, not specific to the asset.",
                topic: "Cost of PPE (IAS 16)",
                isTricky: false
            },
            // Topic 2: The objective of depreciation
            {
                id: 4,
                question: "The primary objective of charging depreciation is to:",
                options: ["Allocate the asset's cost over its useful life", "Set aside funds to replace the asset", "Show the asset at its market value", "Reduce the company's tax liability"],
                type: 'single',
                answer: "Allocate the asset's cost over its useful life",
                explanation: "Depreciation is a systematic allocation of the depreciable amount of an asset over its useful life, based on the accrual principle. It is not a valuation process or a method of funding.",
                topic: "Objective of Depreciation",
                isTricky: false
            },
            {
                id: 5,
                question: "Depreciation is an application of which accounting principle?",
                options: ["Prudence", "Going Concern", "Accrual", "Consistency"],
                type: 'single',
                answer: "Accrual",
                explanation: "The accrual principle requires that costs are matched with the revenues they help to generate. Depreciation matches the cost of using a non-current asset with the periods that benefit from its use.",
                topic: "Objective of Depreciation",
                isTricky: false
            },
            // Topic 3: Calculating depreciation
            {
                id: 6,
                question: "A machine was purchased for Â£50,000. It has a useful life of 5 years and a residual value of Â£5,000. What is the annual depreciation charge using the straight-line method?",
                options: ["Â£10,000", "Â£9,000", "Â£11,000", "Â£8,000"],
                type: 'single',
                answer: "Â£9,000",
                explanation: "Straight-line depreciation = (Cost - Residual Value) / Useful Life = (Â£50,000 - Â£5,000) / 5 years = Â£9,000 per year.",
                topic: "Calculating Depreciation",
                isTricky: false
            },
            {
                id: 7,
                question: "An asset costing Â£20,000 is depreciated at 25% per annum using the reducing balance method. What is the depreciation charge for the second year?",
                options: ["Â£5,000", "Â£4,000", "Â£3,750", "Â£1,250"],
                type: 'single',
                answer: "Â£3,750",
                explanation: "Year 1 depreciation = Â£20,000 * 25% = Â£5,000. Carrying amount at end of Year 1 = Â£20,000 - Â£5,000 = Â£15,000. Year 2 depreciation = Â£15,000 * 25% = Â£3,750.",
                topic: "Calculating Depreciation",
                isTricky: true
            },
            {
                id: 8,
                question: "A business buys an asset on 1 April 20X1 for Â£24,000 with a 4-year useful life and nil residual value. The reporting period ends on 31 December. What is the depreciation charge for the year ended 31 December 20X1 using the straight-line method?",
                options: ["Â£6,000", "Â£4,500", "Â£1,500", "Â£500"],
                type: 'single',
                answer: "Â£4,500",
                explanation: "Annual depreciation = Â£24,000 / 4 = Â£6,000. The asset was used for 9 months (April to December). Pro-rata charge = Â£6,000 * (9/12) = Â£4,500.",
                topic: "Calculating Depreciation",
                isTricky: false
            },
            {
                id: 9,
                question: "An asset was purchased for Â£20,000 with an estimated useful life of 10 years and no residual value. After 4 years, the business decides the asset has a remaining useful life of 10 more years. What is the depreciation charge for Year 5 using the straight-line method?",
                options: ["Â£2,000", "Â£1,500", "Â£1,200", "Â£800"],
                type: 'single',
                answer: "Â£1,200",
                explanation: "Initial annual depreciation = Â£20,000 / 10 = Â£2,000. After 4 years, accumulated depreciation is Â£2,000 * 4 = Â£8,000. The carrying amount is Â£20,000 - Â£8,000 = Â£12,000. This carrying amount is spread over the new remaining useful life of 10 years. New annual charge = Â£12,000 / 10 = Â£1,200.",
                topic: "Changes in Accounting Estimates",
                isTricky: true
            },
            // Topic 4: Accounting for depreciation
            {
                id: 10,
                question: "What is the correct double entry to record the annual depreciation charge for machinery?",
                options: ["DR Machinery Cost, CR Depreciation Expense", "DR Accumulated Depreciation, CR Depreciation Expense", "DR Depreciation Expense, CR Machinery Cost", "DR Depreciation Expense, CR Accumulated Depreciation"],
                type: 'single',
                answer: "DR Depreciation Expense, CR Accumulated Depreciation",
                explanation: "The depreciation charge is an expense, so the expense account is debited. The accumulated depreciation account (a contra-asset account) is credited, which reduces the carrying amount of the asset on the statement of financial position.",
                topic: "Accounting for Depreciation",
                isTricky: false
            },
            {
                id: 11,
                question: "The carrying amount of a non-current asset is its cost less ________.",
                options: ["residual value", "accumulated depreciation and accumulated impairment losses", "the current year's depreciation charge", "market value"],
                type: 'fill-in-the-blank',
                answer: "accumulated depreciation and accumulated impairment losses",
                explanation: "Carrying amount (or book value) is defined as the asset's cost minus the total depreciation and any impairment losses charged against it to date.",
                topic: "Accounting for Depreciation",
                isTricky: false
            },
            // Topic 5: Impairment of assets (IAS 36)
            {
                id: 12,
                question: "An impairment loss occurs when an asset's carrying amount is _______ its recoverable amount.",
                options: ["less than", "equal to", "greater than", "not related to"],
                type: 'fill-in-the-blank',
                answer: "greater than",
                explanation: "Impairment is the reduction in the value of an asset, which is recognized when its carrying amount exceeds its recoverable amount. The asset should not be carried at more than it can be recovered through use or sale.",
                topic: "Impairment of Assets (IAS 36)",
                isTricky: false
            },
            {
                id: 13,
                question: "The recoverable amount of an asset is the higher of its:",
                options: ["Fair value less costs of disposal and its value in use", "Cost and its market value", "Carrying amount and its fair value", "Value in use and its original cost"],
                type: 'single',
                answer: "Fair value less costs of disposal and its value in use",
                explanation: "IAS 36 defines recoverable amount as the higher of what the asset could be sold for (net of selling costs) and the present value of future cash flows expected from its continued use (value in use).",
                topic: "Impairment of Assets (IAS 36)",
                isTricky: false
            },
            {
                id: 14,
                question: "A building has a carrying amount of Â£75,000. An impairment review determines its fair value less disposal costs is Â£60,000 and its value in use is Â£50,000. What is the impairment loss?",
                options: ["Â£25,000", "Â£15,000", "Â£10,000", "No impairment loss"],
                type: 'single',
                answer: "Â£15,000",
                explanation: "The recoverable amount is the higher of Â£60,000 and Â£50,000, which is Â£60,000. The impairment loss = Carrying Amount - Recoverable Amount = Â£75,000 - Â£60,000 = Â£15,000.",
                topic: "Impairment of Assets (IAS 36)",
                isTricky: false
            },
            {
                id: 15,
                question: "Which of the following are external indicators of impairment? (Select all that apply)",
                options: ["Evidence of physical damage to the asset", "A significant fall in the asset's market value", "Adverse changes in the use of the asset", "A significant change in the technological or economic environment"],
                type: 'multiple',
                answer: ["A significant fall in the asset's market value", "A significant change in the technological or economic environment"],
                explanation: "A fall in market value and changes in the external environment are external indicators. Physical damage and changes in use are internal indicators of impairment.",
                topic: "Impairment of Assets (IAS 36)",
                isTricky: false
            },
            // Topic 6: Non-current asset disposals
            {
                id: 16,
                question: "A machine with an original cost of Â£30,000 and accumulated depreciation of Â£12,000 is sold for Â£19,000 cash. What is the profit or loss on disposal?",
                options: ["Â£1,000 profit", "Â£1,000 loss", "Â£11,000 profit", "Â£11,000 loss"],
                type: 'single',
                answer: "Â£1,000 profit",
                explanation: "Carrying amount = Cost - Accumulated Depreciation = Â£30,000 - Â£12,000 = Â£18,000. Profit/Loss = Disposal Proceeds - Carrying Amount = Â£19,000 - Â£18,000 = Â£1,000 profit.",
                topic: "Asset Disposals",
                isTricky: false
            },
            {
                id: 17,
                question: "When accounting for a disposal, which of the following steps is correct?",
                options: ["Debit the disposal account with the sales proceeds", "Credit the disposal account with the asset's original cost", "Debit the accumulated depreciation account with the depreciation related to the disposed asset", "All of the above"],
                type: 'single',
                answer: "Debit the accumulated depreciation account with the depreciation related to the disposed asset",
                explanation: "The correct journal entries are: DR Disposal with asset cost, CR Asset Cost account. DR Accumulated Depreciation, CR Disposal. DR Cash/Receivable, CR Disposal. Therefore, debiting the accumulated depreciation account is a correct step.",
                topic: "Asset Disposals",
                isTricky: true
            },
            {
                id: 18,
                question: "A business trades in an old van (cost Â£15,000, accumulated depreciation Â£11,000) for a new van. The supplier gives a part-exchange value of Â£3,000. What is the loss on disposal of the old van?",
                options: ["Â£1,000", "Â£4,000", "Â£12,000", "Â£3,000"],
                type: 'single',
                answer: "Â£1,000",
                explanation: "Carrying amount of old van = Â£15,000 - Â£11,000 = Â£4,000. The part-exchange value acts as the disposal proceeds (Â£3,000). Loss = Carrying Amount - Proceeds = Â£4,000 - Â£3,000 = Â£1,000.",
                topic: "Asset Disposals",
                isTricky: false
            },
            // Topic 7: The asset register
            {
                id: 19,
                question: "Which of the following items is typically NOT found in a non-current asset register?",
                options: ["Manufacturer's serial number", "Location of the asset", "Original purchase invoice number", "Disposal proceeds of the asset"],
                type: 'single',
                answer: "Disposal proceeds of the asset",
                explanation: "The asset register contains details for managing and controlling the asset during its life (ID, location, cost, depreciation method). Disposal proceeds are part of the disposal transaction, recorded in the disposal account, not typically maintained in the register itself.",
                topic: "The Asset Register",
                isTricky: false
            },
            {
                id: 20,
                question: "The primary purpose of maintaining a non-current asset register is for:",
                options: ["Calculating tax liabilities", "Financial reporting to shareholders", "Internal control and management", "Determining the company's market value"],
                type: 'single',
                answer: "Internal control and management",
                explanation: "The asset register is a detailed listing that helps a business track, locate, and manage its individual assets, which is a key internal control function.",
                topic: "The Asset Register",
                isTricky: false
            },
            // Topic 8: Intangible non-current assets
            {
                id: 21,
                question: "Which of the following intangible assets can NEVER be capitalised if it is internally generated?",
                options: ["Patent", "Development Costs", "Brand", "Software"],
                type: 'single',
                answer: "Brand",
                explanation: "Under IAS 38, costs of internally generated brands, mastheads, publishing titles, customer lists and items similar in substance cannot be distinguished from the cost of developing the business as a whole. Therefore, they are not recognised as intangible assets.",
                topic: "Intangible Assets (IAS 38)",
                isTricky: true
            },
            {
                id: 22,
                question: "The process of allocating the cost of an intangible asset over its useful life is called:",
                options: ["Depreciation", "Amortisation", "Impairment", "Depletion"],
                type: 'single',
                answer: "Amortisation",
                explanation: "Amortisation is the term used for the systematic allocation of the cost of an intangible asset over its useful life, similar to depreciation for tangible assets.",
                topic: "Intangible Assets (IAS 38)",
                isTricky: false
            },
            {
                id: 23,
                question: "Goodwill arising on the acquisition of a business is calculated as:",
                options: ["The fair value of the acquired business's net assets", "The total value of the acquired business's intangible assets", "The excess of purchase consideration over the fair value of the net assets acquired", "The seller's valuation of their business reputation"],
                type: 'single',
                answer: "The excess of purchase consideration over the fair value of the net assets acquired",
                explanation: "Goodwill is the premium paid to acquire a business over and above the fair value of its identifiable net assets (assets minus liabilities).",
                topic: "Goodwill",
                isTricky: false
            },
            {
                id: 24,
                question: "Under IFRS, purchased goodwill with an indefinite life should be:",
                options: ["Amortised over a maximum of 10 years", "Amortised over 20 years", "Not amortised, but tested for impairment annually", "Written off immediately to profit or loss"],
                type: 'single',
                answer: "Not amortised, but tested for impairment annually",
                explanation: "IFRS requires that goodwill is not amortised. Instead, it must be tested for impairment at least annually to ensure its carrying amount is not overstated.",
                topic: "Goodwill",
                isTricky: false
            },
            {
                id: 25,
                question: "A company spends Â£5m on a research and development project. The accountant determines that Â£2m relates to the 'research' phase and Â£3m relates to the 'development' phase, which meets the capitalization criteria of IAS 38. How should this be treated?",
                options: ["Capitalise Â£5m as an intangible asset", "Expense Â£5m to profit or loss", "Capitalise Â£3m and expense Â£2m", "Capitalise Â£2m and expense Â£3m"],
                type: 'single',
                answer: "Capitalise Â£3m and expense Â£2m",
                explanation: "IAS 38 requires expenditure during the research phase to be expensed as incurred. Expenditure during the development phase can be capitalised if specific criteria are met.",
                topic: "Intangible Assets (IAS 38)",
                isTricky: false
            },
            // Topic 9: Non-current assets notes
            {
                id: 26,
                question: "Which of the following items does NOT appear in the non-current asset note to the financial statements?",
                options: ["Additions during the period", "Depreciation charge for the period", "Profit or loss on disposals", "Carrying amount at the end of the period"],
                type: 'single',
                answer: "Profit or loss on disposals",
                explanation: "The non-current asset note (or PPE reconciliation) shows the movement in cost and accumulated depreciation. The profit or loss on disposal is shown separately in the statement of profit or loss.",
                topic: "Notes to the Financial Statements",
                isTricky: true
            },
            // Mixed and Scenario Questions
            {
                id: 27,
                question: "A company's policy is to depreciate vehicles at 25% per annum on the reducing balance basis. A vehicle was purchased on 1 Jan 20X1 for Â£20,000. It was sold on 1 Jan 20X3 for Â£12,000. What is the profit or loss on disposal?",
                options: ["Â£3,000 loss", "Â£3,000 profit", "Â£750 loss", "Â£750 profit"],
                type: 'single',
                answer: "Â£750 profit",
                explanation: "Depreciation for 20X1 = 25% of Â£20,000 = Â£5,000. Carrying amount at 31 Dec 20X1 = Â£15,000. Depreciation for 20X2 = 25% of Â£15,000 = Â£3,750. Carrying amount at 31 Dec 20X2 (date of disposal) = Â£11,250. Profit = Proceeds - Carrying Amount = Â£12,000 - Â£11,250 = Â£750 profit.",
                topic: "Asset Disposals",
                isTricky: true
            },
            {
                id: 28,
                question: "Subsequent expenditure on a non-current asset should be capitalised if it...",
                options: ["maintains the asset's existing performance.", "is a minor repair.", "enhances the economic benefits of the asset.", "is part of a routine service schedule."],
                type: 'single',
                answer: "enhances the economic benefits of the asset.",
                explanation: "Only expenditure that enhances the asset (e.g., improves efficiency, extends life, increases output) can be capitalised. Routine maintenance and repairs are expensed.",
                topic: "Cost of PPE (IAS 16)",
                isTricky: false
            },
            {
                id: 29,
                question: "A company buys a building for Â£200,000 on 1.1.X0 with a 10-year life. On 1.1.X2, it adds an extension costing Â£50,000, which does not change the total useful life. What is the total depreciation charge for year X2?",
                options: ["Â£20,000", "Â£25,000", "Â£26,250", "Â£27,000"],
                type: 'single',
                answer: "Â£26,250",
                explanation: "Depreciation on original building = Â£200,000 / 10 years = Â£20,000. The extension is added at the start of X2, with 8 years of life remaining for the main building. Depreciation on extension = Â£50,000 / 8 years = Â£6,250. Total charge for X2 = Â£20,000 + Â£6,250 = Â£26,250.",
                topic: "Calculating Depreciation",
                isTricky: true
            },
            {
                id: 30,
                question: "Which of these statements about depreciation is FALSE?",
                options: ["Freehold land is not normally depreciated.", "A change in depreciation method is a change in accounting estimate.", "Depreciation is a process of valuation.", "The reducing balance method results in a higher charge in the early years of an asset's life."],
                type: 'single',
                answer: "Depreciation is a process of valuation.",
                explanation: "Depreciation is a process of cost allocation, not valuation. Its purpose is to spread the cost of an asset over the periods it benefits, not to reflect its current market value.",
                topic: "Objective of Depreciation",
                isTricky: false
            },
            {
                id: 31,
                question: "An asset with a carrying amount of Â£102,000 undergoes an impairment review. Its fair value less costs to sell is Â£80,000 and its value in use is Â£95,000. The remaining useful life is 10 years. What is the depreciation charge for the following year?",
                options: ["Â£10,200", "Â£8,000", "Â£9,500", "Â£700"],
                type: 'single',
                answer: "Â£9,500",
                explanation: "First, find the impairment loss. Recoverable amount is the higher of Â£80k and Â£95k, so it's Â£95k. Impairment loss = Â£102k - Â£95k = Â£7k. The new carrying amount is Â£95k. This is depreciated over the remaining 10 years. New depreciation charge = Â£95,000 / 10 = Â£9,500.",
                topic: "Impairment and Depreciation",
                isTricky: true
            },
            {
                id: 32,
                question: "A right-of-use asset acquired under a lease should be presented in the statement of financial position within:",
                options: ["Current Assets", "Intangible Assets", "Non-current Assets", "Equity"],
                type: 'single',
                answer: "Non-current Assets",
                explanation: "IFRS 16 requires a lessee to recognise a right-of-use asset, which represents its right to use the leased asset. This is presented within non-current assets.",
                topic: "Leased Assets (IFRS 16)",
                isTricky: false
            },
            {
                id: 33,
                question: "Which of the following statements is true regarding a part-exchange transaction?",
                options: ["The part-exchange value is ignored when calculating profit/loss on disposal.", "The part-exchange value is treated as the disposal proceeds for the old asset.", "The cost of the new asset is recorded net of the part-exchange value.", "Any loss on disposal is added to the cost of the new asset."],
                type: 'single',
                answer: "The part-exchange value is treated as the disposal proceeds for the old asset.",
                explanation: "In a part-exchange, the value given for the old asset is effectively its sale price and is used to calculate the profit or loss on its disposal.",
                topic: "Asset Disposals",
                isTricky: false
            },
            {
                id: 34,
                question: "The total amount to be depreciated over an asset's useful life is known as its:",
                options: ["Carrying amount", "Residual value", "Depreciable amount", "Fair value"],
                type: 'single',
                answer: "Depreciable amount",
                explanation: "The depreciable amount is defined as the cost of an asset, or other amount substituted for cost, less its residual value.",
                topic: "Depreciation Concepts",
                isTricky: false
            },
            {
                id: 35,
                question: "A business purchased two machines for Â£15,000 each on 1 Jan 20X5 with a 5-year life and nil residual value (SLM). Machine 1 was sold on 31 March 20X7 for Â£8,000. What was the profit or loss on this disposal?",
                options: ["Â£250 loss", "Â£250 profit", "Â£1,750 loss", "Â£1,750 profit"],
                type: 'single',
                answer: "Â£250 loss",
                explanation: "Annual depreciation = Â£15,000 / 5 = Â£3,000. Depreciation for 2.25 years (Jan X5 to Mar X7) = Â£3,000 * 2.25 = Â£6,750. Carrying amount = Â£15,000 - Â£6,750 = Â£8,250. Loss = Carrying amount - Proceeds = Â£8,250 - Â£8,000 = Â£250 loss.",
                topic: "Asset Disposals",
                isTricky: true
            },
            {
                id: 36,
                question: "If there is a change in the estimate of an asset's useful life, how is this change accounted for?",
                options: ["Retrospectively, by restating previous years' financial statements.", "Prospectively, by adjusting the depreciation charge in the current and future periods.", "By a direct adjustment to retained earnings.", "It is not accounted for until the asset is disposed of."],
                type: 'single',
                answer: "Prospectively, by adjusting the depreciation charge in the current and future periods.",
                explanation: "A change in useful life is a change in an accounting estimate. Such changes are accounted for prospectively, meaning they only affect the current and future periods. The carrying amount at the date of the change is depreciated over the revised remaining useful life.",
                topic: "Changes in Accounting Estimates",
                isTricky: false
            },
            {
                id: 37,
                question: "Which of the following are valid methods of depreciation mentioned in the text? (Select all that apply)",
                options: ["Straight-line method", "Sum-of-the-years'-digits method", "Reducing balance method", "Units of production method"],
                type: 'multiple',
                answer: ["Straight-line method", "Reducing balance method"],
                explanation: "The chapter focuses specifically on the straight-line and reducing balance methods as the relevant methods for the Accounting exam.",
                topic: "Calculating Depreciation",
                isTricky: false
            },
            {
                id: 38,
                question: "An asset's ________ life may be longer than its ________ life to a particular business.",
                options: ["useful, economic", "economic, useful", "depreciable, economic", "accounting, useful"],
                type: 'fill-in-the-blank',
                answer: "economic, useful",
                explanation: "Economic life is the total period an asset is usable by one or more users. Useful life is the period an entity expects to use the asset. A company may have a policy to replace cars every 3 years (useful life), even if the car's economic life is 10 years.",
                topic: "Depreciation Concepts",
                isTricky: false
            },
            {
                id: 39,
                question: "A company purchases a licence for Â£240,000 that is valid for 4 years. The double entry to record the first year's amortisation is:",
                options: ["DR Licence Cost Â£60,000, CR Amortisation Expense Â£60,000", "DR Amortisation Expense Â£60,000, CR Licence Cost Â£60,000", "DR Amortisation Expense Â£60,000, CR Accumulated Amortisation Â£60,000", "DR Accumulated Amortisation Â£60,000, CR Amortisation Expense Â£60,000"],
                type: 'single',
                answer: "DR Amortisation Expense Â£60,000, CR Accumulated Amortisation Â£60,000",
                explanation: "The annual amortisation is Â£240,000 / 4 = Â£60,000. This is an expense (Debit) and is credited to an accumulated amortisation account, similar to accumulated depreciation.",
                topic: "Intangible Assets (IAS 38)",
                isTricky: false
            },
            {
                id: 40,
                question: "The cost of a major overhaul of a machine that restores economic benefits and extends its useful life should be:",
                options: ["Expensed immediately in the statement of profit or loss.", "Capitalised and added to the carrying amount of the machine.", "Ignored for accounting purposes.", "Offset against the accumulated depreciation of the machine."],
                type: 'single',
                answer: "Capitalised and added to the carrying amount of the machine.",
                explanation: "Subsequent expenditure that enhances an asset or restores benefits consumed (like a major overhaul) meets the criteria for capitalisation and should be added to the asset's cost.",
                topic: "Cost of PPE (IAS 16)",
                isTricky: false
            },
            {
                id: 41,
                question: "Which of the following situations would require an impairment review for an asset?",
                options: ["The asset's market value has increased unexpectedly.", "The asset is performing better than expected.", "There is evidence of obsolescence or physical damage.", "All of the above"],
                type: 'single',
                answer: "There is evidence of obsolescence or physical damage.",
                explanation: "Obsolescence and physical damage are internal indicators that an asset's value may be impaired, triggering the need for an impairment review. Increased value or performance are the opposite of impairment indicators.",
                topic: "Impairment of Assets (IAS 36)",
                isTricky: false
            },
            {
                id: 42,
                question: "A business buys another company for Â£500,000. The fair value of the acquired company's identifiable net assets is Â£420,000. The statement of financial position of the acquiring company will show:",
                options: ["Goodwill of Â£80,000 as a current asset.", "Goodwill of Â£80,000 as an intangible non-current asset.", "A gain on bargain purchase of Â£80,000 in profit or loss.", "No goodwill, as it was internally generated by the seller."],
                type: 'single',
                answer: "Goodwill of Â£80,000 as an intangible non-current asset.",
                explanation: "The excess of the purchase consideration (Â£500k) over the fair value of net assets acquired (Â£420k) is Â£80,000. This is purchased goodwill and is recognised as an intangible non-current asset.",
                topic: "Goodwill",
                isTricky: false
            },
            {
                id: 43,
                question: "What is the carrying amount of a lorry at the end of Year 2, if it cost Â£17,000, has a 5-year life, a residual value of Â£2,000, and is depreciated at 35% reducing balance?",
                options: ["Â£7,182", "Â£11,050", "Â£5,950", "Â£3,868"],
                type: 'single',
                answer: "Â£7,182",
                explanation: "Year 1 dep = Â£17,000 * 35% = Â£5,950. CA Y1 = Â£11,050. Year 2 dep = Â£11,050 * 35% = Â£3,867.50. CA Y2 = Â£11,050 - Â£3,867.50 = Â£7,182.50. Note: Residual value is ignored in the reducing balance calculation in the exam context provided.",
                topic: "Calculating Depreciation",
                isTricky: true
            },
            {
                id: 44,
                question: "The accumulated depreciation account is a ________ and normally has a ________ balance.",
                options: ["liability account, credit", "contra-asset account, credit", "expense account, debit", "revenue account, credit"],
                type: 'fill-in-the-blank',
                answer: "contra-asset account, credit",
                explanation: "Accumulated depreciation reduces the gross value of an asset, so it's a contra-asset account. As it reduces an asset (which has a debit balance), it has a credit balance.",
                topic: "Accounting for Depreciation",
                isTricky: false
            },
            {
                id: 45,
                question: "After an impairment loss is recognised, the future depreciation charge for the asset should be based on:",
                options: ["The asset's original cost.", "The asset's revised carrying amount (the recoverable amount).", "The asset's fair value, ignoring value in use.", "The original depreciation schedule."],
                type: 'single',
                answer: "The asset's revised carrying amount (the recoverable amount).",
                explanation: "Once an asset is written down to its recoverable amount, this new carrying amount is depreciated over its remaining useful life.",
                topic: "Impairment and Depreciation",
                isTricky: false
            },
            {
                id: 46,
                question: "A company changes its depreciation method from reducing balance to straight-line for a class of assets. This change is considered a:",
                options: ["Change in accounting policy", "Correction of a prior period error", "Change in accounting estimate", "None of the above"],
                type: 'single',
                answer: "Change in accounting estimate",
                explanation: "A change in depreciation method reflects a change in the expected pattern of consumption of the asset's economic benefits. This is treated as a change in accounting estimate, applied prospectively.",
                topic: "Changes in Accounting Estimates",
                isTricky: true
            },
            {
                id: 47,
                question: "A company's trial balance shows 'Motor Vehicles - Cost' at Â£70,000 and 'Motor Vehicles - Accumulated Depreciation' at Â£40,000. How will this be presented in the statement of financial position?",
                options: ["As a single line item 'Motor Vehicles' with a value of Â£30,000.", "As two separate line items: 'Motor Vehicles' at Â£70,000 and 'Accumulated Depreciation' at Â£40,000.", "It will only be shown in the notes to the accounts.", "As a single line item 'Property, plant and equipment' with the value of Â£30,000 included in the total."],
                type: 'single',
                answer: "As a single line item 'Property, plant and equipment' with the value of Â£30,000 included in the total.",
                explanation: "On the face of the statement of financial position, individual asset classes are typically aggregated into a single line, 'Property, plant and equipment'. The detailed breakdown (cost and accumulated depreciation) is shown in the notes.",
                topic: "Notes to the Financial Statements",
                isTricky: false
            },
            {
                id: 48,
                question: "Which of the following statements about residual value is correct?",
                options: ["It must always be assumed to be zero.", "It is deducted from the asset's cost to determine the depreciable amount.", "It is ignored when using the reducing balance method for exam purposes.", "Both B and C are correct."],
                type: 'single',
                answer: "Both B and C are correct.",
                explanation: "Residual value is the estimated disposal value at the end of an asset's useful life. It is subtracted from cost to calculate the depreciable amount for the straight-line method. However, the text notes that for exam purposes, it is not used in reducing balance calculations.",
                topic: "Depreciation Concepts",
                isTricky: false
            },
            {
                id: 49,
                question: "A disposal account is a temporary account used to calculate the ________ on disposal.",
                options: ["cash proceeds", "carrying amount", "profit or loss", "depreciation charge"],
                type: 'fill-in-the-blank',
                answer: "profit or loss",
                explanation: "The disposal account gathers the cost of the asset (debit) and its accumulated depreciation and proceeds (credits). The balancing figure on the account represents the profit or loss on the disposal.",
                topic: "Asset Disposals",
                isTricky: false
            },
            {
                id: 50,
                question: "An asset cost Â£120,000 with a 20-year life. On 31 Dec 20X3 (after 3 years), its carrying amount is Â£102,000. The remaining useful life is revised to 15 years from that date. The revised annual depreciation is:",
                options: ["Â£6,000", "Â£8,000", "Â£6,800", "Â£5,667"],
                type: 'single',
                answer: "Â£6,800",
                explanation: "The remaining carrying amount of Â£102,000 is spread over the new remaining useful life of 15 years. Revised annual depreciation = Â£102,000 / 15 years = Â£6,800.",
                topic: "Changes in Accounting Estimates",
                isTricky: true
            }
        ];

        // --- APPLICATION LOGIC ---
        const homeScreen = document.getElementById('home-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const reviewScreen = document.getElementById('review-screen');

        const startQuizBtn = document.getElementById('start-quiz-btn');
        const questionTracker = document.getElementById('question-tracker');
        const questionNumberEl = document.getElementById('question-number');
        const trickyIndicator = document.getElementById('tricky-indicator');
        const timerEl = document.getElementById('timer');
        const flagBtn = document.getElementById('flag-btn');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        
        const correctPercentageEl = document.getElementById('correct-percentage');
        const incorrectPercentageEl = document.getElementById('incorrect-percentage');
        const correctCountEl = document.getElementById('correct-count');
        const incorrectCountEl = document.getElementById('incorrect-count');
        const unattemptedCountEl = document.getElementById('unattempted-count');
        const xpEarnedEl = document.getElementById('xp-earned');
        const badgesEarnedEl = document.getElementById('badges-earned');
        const reviewTopicsList = document.getElementById('review-topics-list');
        const reviewAnswersBtn = document.getElementById('review-answers-btn');
        const tryAgainBtn = document.getElementById('try-again-btn');

        const reviewContent = document.getElementById('review-content');
        const backToResultsBtn = document.getElementById('back-to-results-btn');

        // Modal Elements
        const confirmModal = document.getElementById('confirm-modal');
        const modalTitleEl = document.getElementById('modal-title');
        const modalTextEl = document.getElementById('modal-text');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');

        let currentQuestionIndex = 0;
        let userAnswers = new Array(questions.length).fill(null);
        let flaggedQuestions = new Set();
        let timerId;
        const totalTime = 45 * 60; // 45 minutes in seconds
        let timeRemaining = totalTime;
        let onConfirmCallback = null;

        function init() {
            startQuizBtn.addEventListener('click', startQuiz);
            prevBtn.addEventListener('click', prevQuestion);
            nextBtn.addEventListener('click', nextQuestion);
            flagBtn.addEventListener('click', toggleFlag);
            submitBtn.addEventListener('click', confirmAndSubmit);
            reviewAnswersBtn.addEventListener('click', showReview);
            tryAgainBtn.addEventListener('click', restartQuiz);
            backToResultsBtn.addEventListener('click', () => {
                reviewScreen.classList.add('hidden');
                resultScreen.classList.remove('hidden');
            });

            // Modal listeners
            modalConfirmBtn.addEventListener('click', () => {
                if (onConfirmCallback) {
                    onConfirmCallback();
                }
                confirmModal.classList.add('hidden');
            });
            modalCancelBtn.addEventListener('click', () => {
                confirmModal.classList.add('hidden');
                onConfirmCallback = null;
            });
        }

        function startQuiz() {
            homeScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            reviewScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            
            currentQuestionIndex = 0;
            userAnswers.fill(null);
            flaggedQuestions.clear();
            timeRemaining = totalTime;

            createTracker();
            loadQuestion(currentQuestionIndex);
            startTimer();
        }

        function createTracker() {
            questionTracker.innerHTML = '';
            for (let i = 0; i < questions.length; i++) {
                const btn = document.createElement('button');
                btn.textContent = i + 1;
                btn.classList.add('tracker-btn', 'unattempted');
                btn.dataset.index = i;
                btn.addEventListener('click', () => {
                    loadQuestion(i);
                });
                questionTracker.appendChild(btn);
            }
        }
        
        function updateTracker() {
            const trackerBtns = questionTracker.querySelectorAll('.tracker-btn');
            trackerBtns.forEach((btn, index) => {
                btn.classList.remove('unattempted', 'attempted', 'flagged', 'current');
                if (index === currentQuestionIndex) {
                    btn.classList.add('current');
                } else if (flaggedQuestions.has(index)) {
                    btn.classList.add('flagged');
                } else if (userAnswers[index] !== null) {
                    btn.classList.add('attempted');
                } else {
                    btn.classList.add('unattempted');
                }
            });
        }

        function loadQuestion(index) {
            currentQuestionIndex = index;
            const question = questions[index];

            questionNumberEl.textContent = index + 1;
            questionTextEl.innerHTML = question.question.replace('________', '<span class="font-bold text-blue-600">________</span>');
            trickyIndicator.classList.toggle('hidden', !question.isTricky);
            
            optionsContainer.innerHTML = '';
            const questionType = question.type;

            if (questionType === 'single' || questionType === 'fill-in-the-blank') {
                question.options.forEach(option => {
                    const optionEl = document.createElement('label');
                    optionEl.className = 'option-label';
                    optionEl.innerHTML = `<input type="radio" name="option" class="mr-3" value="${option}"> ${option}`;
                    optionsContainer.appendChild(optionEl);
                });
            } else if (questionType === 'multiple') {
                 question.options.forEach(option => {
                    const optionEl = document.createElement('label');
                    optionEl.className = 'option-label';
                    optionEl.innerHTML = `<input type="checkbox" name="option" class="mr-3" value="${option}"> ${option}`;
                    optionsContainer.appendChild(optionEl);
                });
            }
            
            // Restore previous answer
            const savedAnswer = userAnswers[index];
            if (savedAnswer) {
                const inputs = optionsContainer.querySelectorAll('input');
                inputs.forEach(input => {
                    if (Array.isArray(savedAnswer) ? savedAnswer.includes(input.value) : savedAnswer === input.value) {
                        input.checked = true;
                        input.parentElement.classList.add('selected');
                    }
                });
            }
            
            // Add event listeners for new options
            optionsContainer.querySelectorAll('input').forEach(input => {
                input.addEventListener('change', handleOptionSelect);
            });

            updateNavButtons();
            updateTracker();
            updateFlagButton();
        }

        function handleOptionSelect(e) {
            const question = questions[currentQuestionIndex];
            const allLabels = optionsContainer.querySelectorAll('label');

            if (question.type === 'multiple') {
                const selectedOptions = Array.from(optionsContainer.querySelectorAll('input:checked')).map(cb => cb.value);
                userAnswers[currentQuestionIndex] = selectedOptions.length > 0 ? selectedOptions : null;
                // Toggle selected class for checkboxes
                allLabels.forEach(label => {
                    const input = label.querySelector('input');
                    if (input.checked) {
                        label.classList.add('selected');
                    } else {
                        label.classList.remove('selected');
                    }
                });
            } else { // single or fill-in-the-blank
                userAnswers[currentQuestionIndex] = e.target.value;
                 // Update selected class for radios
                allLabels.forEach(label => label.classList.remove('selected'));
                e.target.parentElement.classList.add('selected');
            }
            updateTracker();
        }

        function updateNavButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            prevBtn.classList.toggle('opacity-50', prevBtn.disabled);
            nextBtn.disabled = currentQuestionIndex === questions.length - 1;
            nextBtn.classList.toggle('opacity-50', nextBtn.disabled);
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                loadQuestion(currentQuestionIndex - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            }
        }

        function toggleFlag() {
            if (flaggedQuestions.has(currentQuestionIndex)) {
                flaggedQuestions.delete(currentQuestionIndex);
            } else {
                flaggedQuestions.add(currentQuestionIndex);
            }
            updateTracker();
            updateFlagButton();
        }
        
        function updateFlagButton() {
            if (flaggedQuestions.has(currentQuestionIndex)) {
                flagBtn.textContent = 'ğŸš© Unflag';
                flagBtn.classList.remove('btn-secondary');
                flagBtn.classList.add('bg-yellow-400', 'text-yellow-900', 'hover:bg-yellow-500');
            } else {
                flagBtn.textContent = 'ğŸš© Flag This Question';
                flagBtn.classList.add('btn-secondary');
                flagBtn.classList.remove('bg-yellow-400', 'text-yellow-900', 'hover:bg-yellow-500');
            }
        }

        function startTimer() {
            clearInterval(timerId);
            timerId = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                if (timeRemaining <= 0) {
                    clearInterval(timerId);
                    // Directly submit when time is up, no alert needed
                    submitQuiz();
                }
            }, 1000);
        }
        
        function showModal(title, text, callback) {
            modalTitleEl.textContent = title;
            modalTextEl.innerHTML = text; // Use innerHTML to support <br> tags
            onConfirmCallback = callback;
            confirmModal.classList.remove('hidden');
        }

        function confirmAndSubmit() {
            const unattempted = userAnswers.filter(a => a === null).length;
            let message = "Are you sure you want to submit?";
            if (unattempted > 0) {
                message += `<br><br>You have ${unattempted} unattempted questions.`;
            }
            showModal('Confirm Submission', message, () => {
                submitQuiz();
            });
        }

        function submitQuiz() {
            clearInterval(timerId);
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            calculateResults();
        }

        function calculateResults() {
            let correct = 0;
            let incorrect = 0;
            const reviewTopics = new Set();

            questions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                if (userAnswer === null) return;

                let isCorrect = false;
                if (q.type === 'multiple') {
                    // For multiple choice, answers must match exactly
                    const sortedUserAnswer = [...userAnswer].sort();
                    const sortedCorrectAnswer = [...q.answer].sort();
                    isCorrect = JSON.stringify(sortedUserAnswer) === JSON.stringify(sortedCorrectAnswer);
                } else {
                    isCorrect = userAnswer === q.answer;
                }

                if (isCorrect) {
                    correct++;
                } else {
                    incorrect++;
                    reviewTopics.add(q.topic);
                }
            });
            
            const totalAttempted = correct + incorrect;
            const unattempted = questions.length - totalAttempted;
            
            correctPercentageEl.textContent = questions.length > 0 ? `${Math.round((correct / questions.length) * 100)}%` : '0%';
            incorrectPercentageEl.textContent = questions.length > 0 ? `${Math.round((incorrect / questions.length) * 100)}%` : '0%';
            correctCountEl.textContent = correct;
            incorrectCountEl.textContent = incorrect;
            unattemptedCountEl.textContent = unattempted;
            
            // Gamification
            const xp = correct * 10;
            xpEarnedEl.textContent = `You earned ${xp} XP!`;
            if (correct === questions.length) {
                badgesEarnedEl.textContent = 'ğŸ† Perfect Score! & ğŸ“ Subject Master!';
            } else if (correct / questions.length >= 0.8) {
                badgesEarnedEl.textContent = 'ğŸ… High Achiever!';
            } else {
                 badgesEarnedEl.textContent = 'None this time. Keep trying!';
            }

            // Topics to review
            reviewTopicsList.innerHTML = '';
            if (reviewTopics.size > 0) {
                reviewTopics.forEach(topic => {
                    const li = document.createElement('li');
                    li.textContent = `â€¢ ${topic}`;
                    reviewTopicsList.appendChild(li);
                });
            } else if (totalAttempted > 0) {
                reviewTopicsList.innerHTML = '<p class="text-green-600">Great job! No specific topics to review based on your performance.</p>';
            } else {
                reviewTopicsList.innerHTML = '<p>No questions were attempted.</p>';
            }
        }

        function showReview() {
            resultScreen.classList.add('hidden');
            reviewScreen.classList.remove('hidden');
            reviewContent.innerHTML = '';

            questions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const card = document.createElement('div');
                card.className = 'p-6 border rounded-lg';
                
                let answerStatus = '';
                let isCorrect = false;
                if (userAnswer !== null) {
                    if (q.type === 'multiple') {
                        const sortedUserAnswer = [...userAnswer].sort();
                        const sortedCorrectAnswer = [...q.answer].sort();
                        isCorrect = JSON.stringify(sortedUserAnswer) === JSON.stringify(sortedCorrectAnswer);
                    } else {
                        isCorrect = userAnswer === q.answer;
                    }
                    answerStatus = isCorrect ? '<span class="text-green-600 font-bold ml-4">âœ” Correct</span>' : '<span class="text-red-600 font-bold ml-4">âŒ Incorrect</span>';
                } else {
                    answerStatus = '<span class="text-gray-600 font-bold ml-4">ğŸ”² Unattempted</span>';
                }

                let trickyIcon = q.isTricky ? '<span class="text-yellow-500 font-bold ml-2">âš </span>' : '<span class="text-green-500 font-bold ml-2">âœ…</span>';

                let optionsHtml = '';
                q.options.forEach(option => {
                    let optionClass = 'option-label mt-2';
                    const isUserAnswer = Array.isArray(userAnswer) && userAnswer.includes(option);
                    const isCorrectAnswer = Array.isArray(q.answer) ? q.answer.includes(option) : q.answer === option;

                    if (isCorrectAnswer) {
                        optionClass += ' correct';
                    } else if (isUserAnswer && !isCorrectAnswer) {
                        optionClass += ' incorrect';
                    }
                    
                    optionsHtml += `<div class="${optionClass}">${option}</div>`;
                });

                card.innerHTML = `
                    <h4 class="text-lg font-bold">Question ${index + 1}${trickyIcon}${answerStatus}</h4>
                    <p class="mt-2 text-gray-700">${q.question}</p>
                    <div class="mt-4">${optionsHtml}</div>
                    <div class="mt-4 p-4 bg-gray-100 rounded-lg">
                        <p class="font-semibold">Explanation:</p>
                        <p class="text-gray-600">${q.explanation}</p>
                        ${userAnswer ? `<p class="mt-2">Your answer: <span class="font-bold">${Array.isArray(userAnswer) ? userAnswer.join(', ') : userAnswer}</span></p>` : ''}
                        <p class="mt-2">Correct answer: <span class="font-bold text-green-700">${Array.isArray(q.answer) ? q.answer.join(', ') : q.answer}</span></p>
                    </div>
                `;
                reviewContent.appendChild(card);
            });
        }

        function restartQuiz() {
            resultScreen.classList.add('hidden');
            reviewScreen.classList.add('hidden');
            homeScreen.classList.remove('hidden');
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
