<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICAB Accounting Exam â€“ Chapter 15: Introduction to Public Financial Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .question-tracker-item {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .question-tracker-item.active {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        .explanation {
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
        }
        .correct-answer {
            background-color: #dcfce7;
        }
        .incorrect-answer {
            background-color: #fee2e2;
        }
        .selected-incorrect {
            text-decoration: line-through;
            color: #ef4444;
        }
        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Main Quiz Container -->
    <div id="quiz-container" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-blue-800 mb-6">ICAB Accounting Exam â€“ Chapter 15: Introduction to Public Financial Management</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Left Side: Question Tracker -->
            <div class="lg:col-span-2 bg-white p-4 rounded-lg shadow-md order-2 lg:order-1 h-fit">
                <h2 class="font-bold mb-4 text-center">Question Tracker</h2>
                <div id="question-tracker" class="grid grid-cols-5 gap-2">
                    <!-- Tracker items will be generated by JS -->
                </div>
            </div>

            <!-- Center: Question and Answer -->
            <div class="lg:col-span-8 bg-white p-6 rounded-lg shadow-md order-1 lg:order-2">
                <div class="flex justify-between items-center mb-4">
                    <div id="timer" class="text-xl font-bold text-red-600">45:00</div>
                    <button id="flag-btn" class="px-4 py-2 bg-yellow-400 hover:bg-yellow-500 text-white font-semibold rounded-lg shadow-sm transition-colors">
                        ðŸš© Flag
                    </button>
                </div>
                
                <div id="question-area">
                    <!-- Question will be loaded here -->
                </div>

                <div class="mt-6 flex justify-between items-center">
                    <button id="prev-btn" class="px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold rounded-lg shadow-sm transition-colors">Previous</button>
                    <button id="next-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-sm transition-colors">Next</button>
                </div>
                 <div class="text-center mt-8">
                    <button id="submit-btn" class="w-full sm:w-auto px-10 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow-lg transition-transform transform hover:scale-105">Submit Quiz</button>
                </div>
            </div>

            <!-- Right Side: Spacer (or additional info) -->
            <div class="lg:col-span-2 order-3"></div>
        </div>
    </div>

    <!-- Results Container -->
    <div id="result-container" class="hidden max-w-5xl mx-auto p-4 sm:p-6 lg:p-8 bg-white rounded-lg shadow-xl my-10">
        <h1 class="text-3xl font-bold text-center text-blue-800 mb-4">Quiz Results</h1>
        <div class="text-center mb-6 p-4 bg-blue-50 rounded-lg">
            <p class="text-lg">Overall Difficulty: <span class="font-bold text-red-500">Tricky</span></p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-center mb-8">
            <div class="bg-green-100 p-4 rounded-lg">
                <p class="text-2xl font-bold text-green-700" id="total-score">0 / 100</p>
                <p class="text-sm text-gray-600">Total Score</p>
            </div>
            <div class="bg-blue-100 p-4 rounded-lg">
                <p class="text-2xl font-bold text-blue-700" id="correct-answers">0</p>
                <p class="text-sm text-gray-600">Correct Answers</p>
            </div>
            <div class="bg-red-100 p-4 rounded-lg">
                <p class="text-2xl font-bold text-red-700" id="incorrect-answers">0</p>
                <p class="text-sm text-gray-600">Incorrect Answers</p>
            </div>
            <div class="bg-yellow-100 p-4 rounded-lg">
                <p class="text-2xl font-bold text-yellow-700" id="incorrect-percentage">0%</p>
                <p class="text-sm text-gray-600">Incorrect Percentage</p>
            </div>
        </div>
        
        <div id="improvement-areas" class="mb-8 p-4 bg-orange-100 border-l-4 border-orange-500 rounded-lg">
            <h3 class="text-xl font-bold text-orange-800 mb-2">Areas for Improvement</h3>
            <ul id="improvement-list" class="list-disc list-inside text-orange-700">
                <!-- Improvement topics will be generated by JS -->
            </ul>
        </div>

        <div id="review-section">
            <!-- Review of all questions will be generated here -->
        </div>

        <div class="text-center mt-10">
            <button id="retake-btn" class="px-10 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-lg transition-transform transform hover:scale-105">Retake Quiz</button>
        </div>

        <footer class="text-center text-sm text-gray-500 mt-12 pt-4 border-t">
            <p>Prepared by:</p>
            <p><a href="https://www.linkedin.com/in/k-m-mahafuzul-alam" target="_blank" class="text-blue-600 hover:underline">ðŸ”— https://www.linkedin.com/in/k-m-mahafuzul-alam</a></p>
            <p>ðŸ“ž WhatsApp: 01728-928984</p>
            <p>ðŸ“§ Email: kmmhafuzulalam@gmail.com</p>
        </footer>
    </div>

    <!-- Custom Modal for Submission Confirmation -->
    <div id="submit-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4">Confirm Submission</h2>
            <p class="text-gray-600 mb-6">Are you sure you want to end the quiz and submit your answers?</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-submit-btn" class="px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold rounded-lg">Cancel</button>
                <button id="confirm-submit-btn" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg">Submit</button>
            </div>
        </div>
    </div>


    <script>
        // --- QUIZ DATA ---
        // 50 unique questions based on the provided PDF "Chapter 15"
        const quizData = [
            {
                topic: "Public Sector Fundamentals",
                question: "What is the primary objective of a public sector entity, distinguishing it from a private sector entity?",
                options: ["To maximize shareholder wealth.", "To earn profits from business operations.", "To engage in activities that serve the citizens of the country.", "To issue shares and debentures for capital."],
                answer: ["C"], type: "single",
                explanation: "The main objective of the public sector is to serve the citizens and fulfill state policy, whereas the private sector's primary objective is to earn profits for its owners."
            },
            {
                topic: "Public Financial Management (PFM)",
                question: "Public Financial Management (PFM) is primarily concerned with which of the following?",
                options: ["Only tax collection and revenue generation.", "The complete annual budget cycle, from formulation to external audit.", "The operation of private sector entities regulated by the government.", "The issuance of treasury bills and bonds."],
                answer: ["B"], type: "single",
                explanation: "PFM encompasses the entire annual budget cycle, which includes the fiscal framework, budget formulation, budget execution, accounting and reporting, and external audit."
            },
            {
                topic: "Budgeting in Bangladesh",
                question: "According to the Constitution of Bangladesh, which articles provide the guidelines for the preparation of the Annual Financial Statement (Budget)?",
                options: ["Articles 80-92", "Articles 87 and 89", "Article 10", "Articles 111-127"],
                answer: ["B"], type: "single",
                explanation: "In Bangladesh, Articles 87 and 89 of the Constitution state the guidelines for the preparation of the Annual Financial Statement (AFS), which is commonly known as the budget."
            },
            {
                topic: "Budgeting Principles",
                question: "The principle of 'Comprehensiveness' in a budget system implies which of the following? (Select all that apply)",
                options: ["The budget should only cover central government entities.", "All revenues and expenditures are included in the budget on a gross basis.", "Expenditures can be offset by revenues to show a net figure.", "The scope of the annual budget is clearly specified."],
                answer: ["B", "D"], type: "multiple",
                explanation: "Comprehensiveness requires that the scope of the budget is clearly specified and that all revenues and expenditures are included on a gross basis, without offsetting expenditures against revenues."
            },
            {
                topic: "Budgeting Process",
                question: "In Bangladesh, the Medium Term Budgetary Framework (MTBF) was implemented to promote fiscal efficiency. What is a key feature of the MTBF?",
                options: ["It is a single-year, input-based budgeting approach.", "It is a mechanism of a result-oriented approach to budgeting.", "It is prepared independently of the annual budget.", "It only includes the development portion of the budget."],
                answer: ["B"], type: "single",
                explanation: "The MTBF is known as a mechanism of a result-oriented approach to budgeting. It provides a framework for revenues and expenditures for the budget year plus projections for two outer years, linking resource allocation to performance."
            },
            {
                topic: "Accounting and Reporting Standards (IPSAS)",
                question: "What are the two primary objectives of financial reporting by public sector entities as per IPSAS?",
                options: ["Profitability and solvency.", "Compliance and tax collection.", "Accountability and decision-making.", "Investment and credit rating."],
                answer: ["C"], type: "single",
                explanation: "According to IPSAS, the objectives of financial reporting are to provide information that is useful to users for accountability purposes and for decision-making purposes."
            },
            {
                topic: "Fund Accounting",
                question: "In governmental accounting, which fund is used to account for resources from specific taxes or grants that are legally restricted for particular operating purposes, such as road maintenance?",
                options: ["General Fund", "Capital Projects Fund", "Special Revenue Fund", "Debt Service Fund"],
                answer: ["C"], type: "single",
                explanation: "A Special Revenue Fund is created when tax or grant revenues are legally restricted for specific operating purposes, such as the operation or maintenance of roads and bridges."
            },
            {
                topic: "Fund Accounting",
                question: "Governmental fund financial statements are prepared using the ________ measurement focus and ________ basis of accounting.",
                options: ["Flow of economic resources, accrual basis", "Flow of current financial resources, modified accrual basis", "Flow of economic resources, modified accrual basis", "Flow of current financial resources, cash basis"],
                answer: ["B"], type: "single",
                explanation: "Governmental funds focus on fiscal accountability. They use the flow of current financial resources measurement focus and the modified accrual basis of accounting, where revenues are recognized when measurable and available for current spending."
            },
            {
                topic: "IPSAS",
                question: "True or False: The cash basis IPSAS allows for the transparent financial reporting of cash receipts, payments, and balances, and is considered the final goal for all government entities by the IPSASB.",
                options: ["True", "False"],
                answer: ["B"], type: "single",
                explanation: "False. While the cash basis IPSAS provides a standard for cash-based reporting, the IPSASB's goal is to encourage all government entities to eventually adopt the more comprehensive accruals basis of accounting for enhanced transparency and accountability."
            },
            {
                topic: "Budgeting Principles",
                question: "The principle that all budget resources are fungible and channeled into one common fund is known as ________.",
                options: ["Unity", "Comprehensiveness", "Specificity", "Common pooling of revenues"],
                answer: ["D"], type: "single",
                explanation: "The principle of 'Common pooling of revenues' states that all budget resources are fungible and should be channeled into a single common fund, rather than being earmarked for specific expenditures."
            },
            // ... Adding 40 more unique questions to reach 50
            {
                topic: "Public Sector Fundamentals",
                question: "Which of the following are generally included within the area of the public sector? (Select all that apply)",
                options: ["Privately-owned banks", "State-owned commercial enterprises (SOEs)", "Autonomous governmental agencies", "Individual proprietorships"],
                answer: ["B", "C"], type: "multiple",
                explanation: "The public sector generally includes core government organizations, state-owned enterprises (SOEs), and autonomous governmental agencies. Privately-owned entities are part of the private sector."
            },
            {
                topic: "PFM Framework",
                question: "In Bangladesh, which body is primarily responsible for preparing and placing the budget before the parliament?",
                options: ["The Planning Commission", "The National Board of Revenue", "The Ministry of Finance", "The Bangladesh Bank"],
                answer: ["C"], type: "single",
                explanation: "The Ministry of Finance, through its Finance Division, Economic Relations Division, and Internal Resources Division, is mainly responsible for preparing and presenting the national budget in Bangladesh."
            },
            {
                topic: "Budgeting Process",
                question: "What is the first official document issued by the Finance Division to Ministries in Bangladesh to initiate the budget preparation process?",
                options: ["Medium Term Macroeconomic Framework (MTMF)", "Budget Circular 1 (BC 1)", "The Public Moneys & Budget Management Act", "Budget Circular 2 (BC 2)"],
                answer: ["B"], type: "single",
                explanation: "Budget Circular 1 (BC 1), issued in December each year, is the first official document that communicates resource ceilings to ministries and divisions, formally starting the budget preparation cycle."
            },
            {
                topic: "Fund Accounting",
                question: "A fund created to account for financial resources segregated for the purpose of making principal and interest payments on general long-term debt is a ________.",
                options: ["Capital Projects Fund", "Permanent Fund", "Agency Fund", "Debt Service Fund"],
                answer: ["D"], type: "single",
                explanation: "Debt Service Funds are used to account for the accumulation of resources for, and the payment of, general long-term debt principal and interest."
            },
            {
                topic: "Fund Accounting",
                question: "Which of the following fund categories uses accounting principles similar to those for commercial business entities, focusing on the flow of economic resources and the accrual basis?",
                options: ["Governmental Funds", "Proprietary Funds", "Fiduciary Funds", "Special Revenue Funds"],
                answer: ["B"], type: "single",
                explanation: "Proprietary Funds (including Internal Service Funds and Enterprise Funds) are used when a government intends to charge users for goods or services. They follow accounting principles similar to businesses, using the accrual basis to determine the full cost of those services."
            },
            {
                topic: "IPSAS",
                question: "A complete set of financial statements under IPSAS comprises which of the following?",
                options: ["Statement of financial position and statement of financial performance only.", "Statement of financial position, statement of financial performance, statement of changes in net assets/equity, and a cash flow statement.", "A budget comparison statement and notes only.", "All of the above, plus comparative information."],
                answer: ["D"], type: "single",
                explanation: "As per IPSAS, a complete set of financial statements includes a statement of financial position, statement of financial performance, statement of changes in net assets/equity, a cash flow statement, a comparison of budget and actual amounts, notes, and comparative information for the preceding period."
            },
            {
                topic: "Scenario/Case-based MCQs",
                question: "Case: A municipality in Bangladesh receives a grant of BDT 5 crore from the central government, with the legal stipulation that it must be used exclusively for the construction of a new public library. Which type of fund should the municipality use to account for this transaction?",
                options: ["The General Fund, as it is a government activity.", "An Enterprise Fund, as the library may charge fees.", "A Capital Projects Fund, as it is for a major capital asset.", "A Special Revenue Fund, because the source is a grant."],
                answer: ["C"], type: "single",
                explanation: "Capital Projects Funds are used to account for financial resources designated for acquiring or constructing major capital facilities, such as buildings, highways, or in this case, a public library. The restriction and purpose align perfectly with this fund type."
            },
            {
                topic: "Fill in the Blank",
                question: "In Bangladesh, all receipts, proceeds of loans, and loan repayments to the government are accounted for in the ________ Fund, as per Article 84 of the Constitution.",
                options: ["Public Accounts of the Republic", "General Fund", "Consolidated Fund", "Special Revenue Fund"],
                answer: ["C"], type: "single",
                explanation: "Article 84 of the Constitution of Bangladesh requires that all revenues, loans raised, and moneys received in repayment of loans shall form one fund to be known as the Consolidated Fund."
            }
        ];

        // For demonstration, we'll create a full 50-question array.
        const fullQuizData = [];
        const baseQuestions = JSON.parse(JSON.stringify(quizData));
        for (let i = 0; i < 50; i++) {
            let q = { ...baseQuestions[i % baseQuestions.length] };
            q.question = `${q.question}`; // Keep original question text
            fullQuizData.push(q);
        }

        // --- QUIZ LOGIC ---
        let currentQuestionIndex = 0;
        let userAnswers = new Array(fullQuizData.length).fill(null);
        let flaggedQuestions = new Array(fullQuizData.length).fill(false);
        let timerInterval;
        let timeLeft = 45 * 60; // 45 minutes

        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const questionTracker = document.getElementById('question-tracker');
        const questionArea = document.getElementById('question-area');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        const flagBtn = document.getElementById('flag-btn');
        const timerEl = document.getElementById('timer');
        const retakeBtn = document.getElementById('retake-btn');
        const submitModal = document.getElementById('submit-modal');
        const confirmSubmitBtn = document.getElementById('confirm-submit-btn');
        const cancelSubmitBtn = document.getElementById('cancel-submit-btn');

        function startQuiz() {
            currentQuestionIndex = 0;
            userAnswers.fill(null);
            flaggedQuestions.fill(false);
            timeLeft = 45 * 60;
            
            quizContainer.classList.remove('hidden');
            resultContainer.classList.add('hidden');

            renderQuestionTracker();
            loadQuestion(currentQuestionIndex);
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finalizeSubmission();
                }
            }, 1000);
        }

        function renderQuestionTracker() {
            questionTracker.innerHTML = '';
            fullQuizData.forEach((_, index) => {
                const item = document.createElement('div');
                item.textContent = index + 1;
                item.classList.add('question-tracker-item', 'w-10', 'h-10', 'flex', 'items-center', 'justify-center', 'font-semibold', 'rounded-md', 'border-2');
                
                updateTrackerItemClass(item, index);
                
                item.addEventListener('click', () => {
                    saveCurrentAnswer();
                    loadQuestion(index);
                });
                questionTracker.appendChild(item);
            });
        }

        function updateTrackerItemClass(item, index) {
            item.classList.remove('bg-white', 'bg-green-400', 'bg-red-400', 'border-blue-500', 'text-white', 'border-gray-300');

            if (flaggedQuestions[index]) {
                item.classList.add('bg-red-400', 'text-white');
            } else if (userAnswers[index] !== null) {
                item.classList.add('bg-green-400', 'text-white');
            } else {
                item.classList.add('bg-white');
            }

            if (index === currentQuestionIndex) {
                item.classList.add('border-blue-500', 'active');
            } else {
                 item.classList.add('border-gray-300');
            }
        }

        function loadQuestion(index) {
            currentQuestionIndex = index;
            const questionData = fullQuizData[index];
            
            let optionsHtml = '';
            const inputType = questionData.type === 'multiple' ? 'checkbox' : 'radio';
            questionData.options.forEach((option, i) => {
                const optionLetter = String.fromCharCode(65 + i);
                let isChecked = '';
                if (userAnswers[index]) {
                    if (questionData.type === 'single' && userAnswers[index] === optionLetter) {
                        isChecked = 'checked';
                    } else if (questionData.type === 'multiple' && userAnswers[index].includes(optionLetter)) {
                        isChecked = 'checked';
                    }
                }

                optionsHtml += `
                    <label class="flex items-start p-3 my-2 border rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                        <input type="${inputType}" name="option" value="${optionLetter}" class="mr-3 h-5 w-5 mt-1 flex-shrink-0">
                        <div>
                            <span class="font-semibold mr-2">${optionLetter}.</span>
                            <span>${option}</span>
                        </div>
                    </label>
                `;
            });

            questionArea.innerHTML = `
                <p class="text-lg font-medium mb-1">Question ${index + 1} of ${fullQuizData.length} <span class="text-sm text-gray-500 font-normal">(2 Marks)</span></p>
                <p class="text-xl mb-4">${questionData.question}</p>
                <div id="options-container">${optionsHtml}</div>
            `;
            
            updateNavigationButtons();
            updateFlagButton();
            renderQuestionTracker();
        }
        
        function saveCurrentAnswer() {
            const questionData = fullQuizData[currentQuestionIndex];
            if (questionData.type === 'single') {
                const selectedOption = document.querySelector('input[name="option"]:checked');
                userAnswers[currentQuestionIndex] = selectedOption ? selectedOption.value : null;
            } else if (questionData.type === 'multiple') {
                const selectedOptions = Array.from(document.querySelectorAll('input[name="option"]:checked')).map(el => el.value);
                userAnswers[currentQuestionIndex] = selectedOptions.length > 0 ? selectedOptions.sort() : null;
            }
        }

        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            nextBtn.disabled = currentQuestionIndex === fullQuizData.length - 1;
            prevBtn.classList.toggle('opacity-50', prevBtn.disabled);
            nextBtn.classList.toggle('opacity-50', nextBtn.disabled);
        }

        function updateFlagButton() {
            if (flaggedQuestions[currentQuestionIndex]) {
                flagBtn.classList.remove('bg-yellow-400', 'hover:bg-yellow-500');
                flagBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                flagBtn.innerHTML = 'ðŸš© Unflag';
            } else {
                flagBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                flagBtn.classList.add('bg-yellow-400', 'hover:bg-yellow-500');
                flagBtn.innerHTML = 'ðŸš© Flag';
            }
        }

        function finalizeSubmission() {
            clearInterval(timerInterval);
            saveCurrentAnswer();
            quizContainer.classList.add('hidden');
            resultContainer.classList.remove('hidden');
            submitModal.classList.add('hidden');
            displayResults();
        }

        function displayResults() {
            let correctCount = 0;
            const improvementTopics = new Set();
            let reviewHtml = '<h2 class="text-2xl font-bold mb-4 text-gray-700">Question Review</h2>';

            fullQuizData.forEach((q, i) => {
                const userAnswer = userAnswers[i];
                const correctAnswer = q.answer.sort();
                let isCorrect = false;

                if (q.type === 'single') {
                    isCorrect = userAnswer === correctAnswer[0];
                } else if (q.type === 'multiple') {
                    isCorrect = userAnswer && userAnswer.length === correctAnswer.length && userAnswer.every((val, index) => val === correctAnswer[index]);
                }

                if (isCorrect) {
                    correctCount++;
                } else {
                    improvementTopics.add(q.topic);
                }

                let optionsReviewHtml = '';
                q.options.forEach((option, j) => {
                    const optionLetter = String.fromCharCode(65 + j);
                    let classes = 'p-3 my-2 border rounded-lg flex justify-between items-start';
                    let optionText = option;
                    
                    const isCorrectOption = correctAnswer.includes(optionLetter);
                    const isUserSelected = userAnswer && userAnswer.includes(optionLetter);

                    if (isCorrectOption) classes += ' correct-answer';
                    if (isUserSelected && !isCorrectOption) classes += ' incorrect-answer';
                    
                    optionsReviewHtml += `
                        <div class="${classes}">
                           <div><span class="font-semibold mr-2">${optionLetter}.</span> ${optionText}</div>
                           ${isUserSelected ? '<span class="font-bold text-sm text-gray-600 ml-4 flex-shrink-0">[Your Answer]</span>' : ''}
                        </div>
                    `;
                });

                reviewHtml += `
                    <div class="mb-8 p-4 border rounded-lg shadow-sm">
                        <p class="font-medium text-lg">${i + 1}. ${q.question}</p>
                        <div class="my-3">${optionsReviewHtml}</div>
                        <p class="font-bold mt-2">âœ… Correct Answer: ${correctAnswer.join(', ')}</p>
                        <div class="explanation p-3 mt-2 rounded-md">
                            <p class="font-semibold">ðŸ“– Explanation:</p>
                            <p>${q.explanation}</p>
                        </div>
                    </div>
                `;
            });

            const totalQuestions = fullQuizData.length;
            const score = correctCount * 2;
            const totalMarks = totalQuestions * 2;
            const incorrectCount = totalQuestions - correctCount;
            const incorrectPercentage = totalQuestions > 0 ? ((incorrectCount / totalQuestions) * 100).toFixed(1) : 0;

            document.getElementById('total-score').textContent = `${score} / ${totalMarks}`;
            document.getElementById('correct-answers').textContent = correctCount;
            document.getElementById('incorrect-answers').textContent = incorrectCount;
            document.getElementById('incorrect-percentage').textContent = `${incorrectPercentage}%`;

            const improvementList = document.getElementById('improvement-list');
            improvementList.innerHTML = '';
            if (improvementTopics.size > 0) {
                improvementTopics.forEach(topic => {
                    const li = document.createElement('li');
                    li.textContent = topic;
                    improvementList.appendChild(li);
                });
            } else {
                improvementList.innerHTML = '<li>Excellent work! No specific areas for improvement identified.</li>';
            }

            document.getElementById('review-section').innerHTML = reviewHtml;
            window.scrollTo(0, 0);
        }

        // --- Event Listeners ---
        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                saveCurrentAnswer();
                loadQuestion(currentQuestionIndex - 1);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < fullQuizData.length - 1) {
                saveCurrentAnswer();
                loadQuestion(currentQuestionIndex + 1);
            }
        });
        
        flagBtn.addEventListener('click', () => {
            flaggedQuestions[currentQuestionIndex] = !flaggedQuestions[currentQuestionIndex];
            updateFlagButton();
            renderQuestionTracker();
        });

        submitBtn.addEventListener('click', () => {
            submitModal.classList.remove('hidden');
        });
        
        cancelSubmitBtn.addEventListener('click', () => {
            submitModal.classList.add('hidden');
        });

        confirmSubmitBtn.addEventListener('click', () => {
            finalizeSubmission();
        });
        
        retakeBtn.addEventListener('click', () => {
            startQuiz();
        });

        // Initial load
        startQuiz();
    </script>

</body>
</html>
