<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICAB Accounting Exam â€“ Company Financial Statements</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .question-tracker-item {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .question-tracker-item:hover {
            transform: scale(1.1);
        }
        .option-label {
            cursor: pointer;
            display: block;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }
        .option-label:hover {
            background-color: #f3f4f6;
        }
        .option-label.selected {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        .results-section .correct {
            background-color: #dcfce7;
            border-left: 4px solid #22c55e;
        }
        .results-section .incorrect {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }
        .results-section .user-answer {
            font-weight: bold;
        }
        .results-section .correct-answer {
            color: #16a34a;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="quiz-container" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-blue-800 mb-6">ICAB Accounting Exam â€“ Chapter 11: Company Financial Statements</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <!-- Left Side: Question Tracker -->
            <div class="lg:col-span-2 bg-white p-4 rounded-lg shadow-md order-2 lg:order-1 h-fit">
                <h2 class="font-bold mb-4 text-center">Question Tracker</h2>
                <div id="question-tracker" class="grid grid-cols-5 gap-2">
                    <!-- Tracker items will be generated by JS -->
                </div>
            </div>

            <!-- Center: Question and Options -->
            <div class="lg:col-span-7 bg-white p-6 rounded-lg shadow-md order-1 lg:order-2">
                <div id="question-header" class="flex justify-between items-start mb-4">
                    <span id="question-number" class="text-lg font-semibold text-blue-700"></span>
                    <span class="text-sm font-medium text-gray-500">Marks: 2</span>
                </div>
                <div id="question-text" class="text-lg mb-6"></div>
                <div id="options-container" class="space-y-4"></div>
                <div class="mt-8 flex justify-between items-center">
                    <button id="prev-btn" class="px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400 transition-colors">Previous</button>
                    <button id="next-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">Next</button>
                </div>
            </div>

            <!-- Right Side: Timer and Actions -->
            <div class="lg:col-span-3 bg-white p-4 rounded-lg shadow-md order-3 lg:order-3 h-fit">
                <div class="text-center mb-4">
                    <h2 class="font-bold mb-2">Time Remaining</h2>
                    <div id="timer" class="text-3xl font-bold text-red-600 bg-gray-100 p-2 rounded-lg">45:00</div>
                </div>
                <button id="flag-btn" class="w-full mb-4 px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition-colors">Flag for Review</button>
                <button id="submit-btn" class="w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">Submit Quiz</button>
            </div>
        </div>
    </div>

    <div id="results-container" class="hidden max-w-5xl mx-auto p-4 sm:p-6 lg:p-8">
        <h1 class="text-3xl font-bold text-center text-blue-800 mb-6">Quiz Results</h1>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div>
                <p class="text-sm text-gray-500">Total Score</p>
                <p id="total-score" class="text-2xl font-bold"></p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Correct Answers</p>
                <p id="correct-answers" class="text-2xl font-bold text-green-600"></p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Incorrect Answers</p>
                <p id="incorrect-answers" class="text-2xl font-bold text-red-600"></p>
            </div>
            <div>
                <p class="text-sm text-gray-500">Incorrect %</p>
                <p id="incorrect-percentage" class="text-2xl font-bold text-red-600"></p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-bold mb-2">Quiz Difficulty: <span class="text-red-500 font-semibold">Tricky</span></h2>
            <h2 class="text-xl font-bold mb-4">Areas for Improvement:</h2>
            <ul id="improvement-areas" class="list-disc list-inside text-red-700">
                <!-- Improvement areas will be generated by JS -->
            </ul>
        </div>
        
        <div id="results-section" class="space-y-6">
            <!-- Detailed results will be generated by JS -->
        </div>

        <div class="text-center mt-8">
            <button id="retake-btn" class="px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-lg">Retake Quiz</button>
        </div>

        <footer class="text-center mt-12 text-sm text-gray-600">
            <p class="font-semibold">Prepared by:</p>
            <p>ðŸ”— <a href="https://www.linkedin.com/in/k-m-mahafuzul-alam" target="_blank" class="text-blue-600 hover:underline">linkedin.com/in/k-m-mahafuzul-alam</a></p>
            <p>ðŸ“ž WhatsApp: 01728-928984</p>
            <p>ðŸ“§ Email: kmmhafuzulalam@gmail.com</p>
        </footer>
    </div>

    <!-- Modal for submission confirmation -->
    <div id="confirm-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100">
                    <svg class="h-6 w-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">Confirm Submission</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="modal-text" class="text-sm text-gray-500"></p>
                </div>
                <div class="items-center px-4 py-3 space-y-2 sm:space-y-0 sm:flex sm:flex-row-reverse sm:space-x-2 sm:space-x-reverse">
                    <button id="modal-confirm-btn" class="w-full sm:w-auto inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Yes, Submit
                    </button>
                    <button id="modal-cancel-btn" class="w-full sm:w-auto mt-2 sm:mt-0 inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script>
        const quizData = [
            // Questions based on PDF Chapter 11
            {
                question: "A public limited company in Bangladesh must have a minimum issued capital. According to the Companies Act 1994, what is the effective minimum requirement before it can commence business?",
                options: [
                    "BDT 5,000,000 net assets",
                    "BDT 1,000,000 issued capital",
                    "There is no minimum net asset requirement, only a minimum paid-up capital.",
                    "BDT 500,000 net assets"
                ],
                answer: "C",
                type: "single",
                topic: "Nature of a Limited Company",
                explanation: "The UK Companies Act 2006 has specific net asset requirements. However, the equivalent Bangladeshi law, the Companies Act 1994, focuses on a minimum paid-up capital for a public company (BDT 5,00,000), not a specific net asset value before trading. Therefore, the most accurate statement is about paid-up capital. (Reference: PDF Page 365, Section 1.2, adapted for Bangladesh Companies Act 1994)"
            },
            {
                question: "A company issues 500,000 equity shares with a par value of BDT 10 each at a price of BDT 18 per share. What is the correct journal entry to record this transaction?",
                options: [
                    "Debit Bank BDT 9,000,000; Credit Share Capital BDT 9,000,000",
                    "Debit Bank BDT 9,000,000; Credit Share Capital BDT 5,000,000; Credit Retained Earnings BDT 4,000,000",
                    "Debit Bank BDT 9,000,000; Credit Share Capital BDT 5,000,000; Credit Share Premium BDT 4,000,000",
                    "Debit Share Capital BDT 5,000,000; Debit Share Premium BDT 4,000,000; Credit Bank BDT 9,000,000"
                ],
                answer: "C",
                type: "single",
                topic: "Share Capital & Premium",
                explanation: "The cash received is 500,000 shares * BDT 18 = BDT 9,000,000. The amount credited to Share Capital is the par value (500,000 * BDT 10 = BDT 5,000,000). The excess over par value (BDT 18 - BDT 10 = BDT 8 per share) is credited to the Share Premium account (500,000 * BDT 8 = BDT 4,000,000). (Reference: PDF Page 367, Section 3.1)"
            },
            {
                question: "Which of the following statements regarding redeemable and irredeemable preference shares is correct under IFRS?",
                options: [
                    "Both are treated as equity in the statement of financial position.",
                    "Both are treated as non-current liabilities.",
                    "Irredeemable preference shares are equity, while redeemable preference shares are treated as non-current liabilities.",
                    "Redeemable preference shares are equity, while irredeemable preference shares are treated as non-current liabilities."
                ],
                answer: "C",
                type: "single",
                topic: "Share Capital",
                explanation: "Irredeemable preference shares represent a permanent form of capital and are treated as equity. Redeemable preference shares, which the company is obliged to buy back, are treated as debt (non-current liabilities) because they represent an obligation to repay funds. (Reference: PDF Page 366, Section 2.3)"
            },
            {
                question: "A company's retained earnings at the start of the year were BDT 1,500,000. The profit for the year was BDT 450,000. The retained earnings at the end of the year were BDT 1,700,000. What was the total dividend paid during the year?",
                options: [
                    "BDT 250,000",
                    "BDT 450,000",
                    "BDT 200,000",
                    "BDT 700,000"
                ],
                answer: "A",
                type: "single",
                topic: "Dividends & Retained Earnings",
                explanation: "The calculation is: Opening Retained Earnings + Profit for the year - Dividends Paid = Closing Retained Earnings. BDT 1,500,000 + BDT 450,000 - Dividends = BDT 1,700,000. Therefore, Dividends Paid = BDT 1,950,000 - BDT 1,700,000 = BDT 250,000. (Reference: PDF Page 371, Section 4.3)"
            },
            {
                question: "A bonus issue of shares is also known as a ________ issue.",
                options: [
                    "rights",
                    "capitalisation",
                    "preference",
                    "debt"
                ],
                answer: "B",
                type: "single",
                topic: "Bonus & Rights Issues",
                explanation: "A bonus issue is also called a capitalisation issue or scrip issue. It involves converting reserves (like share premium or retained earnings) into share capital. (Reference: PDF Page 372, Section 5.2)"
            },
            {
                question: "Which of the following are true regarding a rights issue? (Choose TWO correct answers)",
                options: [
                    "It is an issue of free shares to existing shareholders.",
                    "It does not involve any cash inflow for the company.",
                    "New shares are offered to existing owners in proportion to their shareholding.",
                    "The issue price is usually at a discount to the current market price."
                ],
                answer: ["C", "D"],
                type: "multiple",
                topic: "Bonus & Rights Issues",
                explanation: "A rights issue is an offer to existing shareholders to buy new shares, typically at a price lower than the current market value, in proportion to what they already own. It is a way to raise new cash. A bonus issue is an issue of free shares. (Reference: PDF Page 371-372, Section 5.1)"
            },
            {
                question: "Under IAS 37, a provision should be recognised when:",
                options: [
                    "A future obligation is possible but not probable.",
                    "A business has a present obligation, and it is probable that an outflow of resources will be required to settle it, and a reliable estimate can be made.",
                    "A business wants to smooth its profits over several years.",
                    "An asset has been impaired."
                ],
                answer: "B",
                type: "single",
                topic: "Provisions (IAS 37)",
                explanation: "IAS 37 specifies strict criteria for recognizing a provision: 1) a present obligation (legal or constructive) as a result of a past event; 2) it is probable (more than 50% likely) that an outflow of economic benefits will be required; and 3) a reliable estimate can be made of the amount. (Reference: PDF Page 377, Section 7)"
            },
            {
                question: "Jamuna Ltd. had a warranty provision of BDT 200,000 at the start of the year. During the year, it paid out BDT 120,000 in warranty claims. At the year-end, the company estimated that a provision of BDT 250,000 is required. What is the charge to the Statement of Profit or Loss for the year in respect of the warranty provision?",
                options: [
                    "BDT 50,000",
                    "BDT 120,000",
                    "BDT 170,000",
                    "BDT 250,000"
                ],
                answer: "C",
                type: "single",
                topic: "Provisions (IAS 37)",
                explanation: "Opening provision: BDT 200,000. Utilised during the year: (BDT 120,000). Provision remaining before adjustment: BDT 80,000. Required closing provision: BDT 250,000. Increase required (charge to P/L): BDT 250,000 - BDT 80,000 = BDT 170,000. (Reference: PDF Page 379, Context Example)"
            },
            {
                question: "An over-provision of tax from the previous year will:",
                options: [
                    "Increase the current year's tax expense.",
                    "Decrease the current year's tax expense.",
                    "Have no effect on the current year's tax expense.",
                    "Be adjusted directly in retained earnings."
                ],
                answer: "B",
                type: "single",
                topic: "Tax",
                explanation: "An over-provision from a prior period means too much tax expense was recognized. This is corrected by reducing the tax expense in the current period's Statement of Profit or Loss. (Reference: PDF Page 381, Section 8.1)"
            },
            {
                question: "According to IFRS 15, revenue from the sale of goods should be recognised when:",
                options: [
                    "The customer places an order.",
                    "The company issues an invoice.",
                    "The company receives cash payment.",
                    "Control of the goods is transferred to the customer."
                ],
                answer: "D",
                type: "single",
                topic: "Revenue (IFRS 15)",
                explanation: "IFRS 15's core principle is that revenue is recognised when a performance obligation is satisfied by transferring a promised good or service to a customer. Transfer occurs when the customer obtains control of that good or service. (Reference: PDF Page 382, Section 9.1)"
            },
            {
                question: "Which of the following items are components of 'Equity' in a company's Statement of Financial Position? (Choose THREE correct answers)",
                options: [
                    "Redeemable Preference Shares",
                    "Share Premium",
                    "Retained Earnings",
                    "Long-term Bank Loan",
                    "Irredeemable Preference Shares"
                ],
                answer: ["B", "C", "E"],
                type: "multiple",
                topic: "Equity Components",
                explanation: "Equity consists of funds contributed by owners and profits retained in the business. This includes Share Capital (including irredeemable preference shares), Share Premium, and Retained Earnings. Redeemable preference shares and bank loans are liabilities. (Reference: PDF Page 365, Section 2)"
            },
            {
                question: "Dividends paid on redeemable preference shares are treated as a ________ in the Statement of Profit or Loss.",
                options: [
                    "distribution of profit",
                    "finance cost",
                    "administrative expense",
                    "reduction of revenue"
                ],
                answer: "B",
                type: "single",
                topic: "Dividends",
                explanation: "Because redeemable preference shares are treated as liabilities (debt), the dividends on them are considered a cost of finance, similar to interest on a loan. They are an expense in the Statement of Profit or Loss, not a distribution of profit from retained earnings. (Reference: PDF Page 370, Section 4.2.2)"
            },
            {
                question: "A company with 1,000,000 shares of BDT 10 par value makes a 1 for 5 bonus issue. The share premium account has a balance of BDT 1,500,000 and retained earnings are BDT 5,000,000. What is the journal entry for the bonus issue, assuming share premium is used first?",
                options: [
                    "Debit Retained Earnings BDT 2,000,000; Credit Share Capital BDT 2,000,000",
                    "Debit Share Premium BDT 1,500,000; Debit Retained Earnings BDT 500,000; Credit Share Capital BDT 2,000,000",
                    "Debit Share Premium BDT 2,000,000; Credit Share Capital BDT 2,000,000",
                    "Debit Cash BDT 2,000,000; Credit Share Capital BDT 2,000,000"
                ],
                answer: "B",
                type: "single",
                topic: "Bonus & Rights Issues",
                explanation: "A 1 for 5 bonus issue on 1,000,000 shares means 200,000 new shares are issued. The par value of these new shares is 200,000 * BDT 10 = BDT 2,000,000. This amount is credited to Share Capital. The debit is first made to Share Premium to its full extent (BDT 1,500,000), and the remainder (BDT 500,000) is debited to Retained Earnings. (Reference: PDF Page 373, Context Example)"
            },
            {
                question: "True or False: The current market value of a company's shares is recorded in its Statement of Financial Position.",
                options: [
                    "True",
                    "False"
                ],
                answer: "B",
                type: "single",
                topic: "Nature of a Limited Company",
                explanation: "False. The current market value reflects the price at which shares are traded between investors and has no bearing on the company's own financial statements. The company's books record the par value and any premium at the time of issue. (Reference: PDF Page 364, Section 1.1)"
            },
            {
                question: "Which accounting standard provides the formats and minimum presentation requirements for company financial statements?",
                options: [
                    "IAS 37",
                    "IFRS 15",
                    "IAS 8",
                    "IAS 1"
                ],
                answer: "D",
                type: "single",
                topic: "Regulatory Framework",
                explanation: "IAS 1, Presentation of Financial Statements, sets out the overall requirements for financial statements, including how they should be structured, the minimum requirements for their content and overriding concepts. (Reference: PDF Page 383, Section 10)"
            },
            // --- Case Study 1 Start ---
            {
                question: `SCENARIO: Padma Corp.'s equity section as at 1 Jan 20X3 was:
                - Equity Shares of BDT 10 each: BDT 20,000,000
                - Share Premium: BDT 8,000,000
                - Retained Earnings: BDT 15,000,000
                On 1 April 20X3, the company made a 1 for 4 rights issue at BDT 15 per share. The issue was fully subscribed.
                What was the balance on the Share Premium account after the rights issue?`,
                options: [
                    "BDT 8,000,000",
                    "BDT 10,500,000",
                    "BDT 13,000,000",
                    "BDT 15,500,000"
                ],
                answer: "B",
                type: "single",
                topic: "Case Study: Equity Transactions",
                explanation: "Number of existing shares = 20,000,000 / 10 = 2,000,000. Rights issue shares = 2,000,000 / 4 = 500,000. Issue price = BDT 15. Par value = BDT 10. Premium per share = 15 - 10 = BDT 5. Total new premium = 500,000 * 5 = BDT 2,500,000. New Share Premium balance = 8,000,000 (opening) + 2,500,000 (new) = BDT 10,500,000."
            },
            {
                question: `SCENARIO (cont.): Following the rights issue, on 1 July 20X3, Padma Corp. made a 1 for 10 bonus issue, utilizing the share premium account first. What was the debit to Retained Earnings for this bonus issue?`,
                options: [
                    "BDT 2,500,000",
                    "BDT 0",
                    "BDT 1,500,000",
                    "BDT 1,000,000"
                ],
                answer: "B",
                type: "single",
                topic: "Case Study: Equity Transactions",
                explanation: "Total shares after rights issue = 2,000,000 + 500,000 = 2,500,000. Bonus shares issued = 2,500,000 / 10 = 250,000. Par value of bonus issue = 250,000 * BDT 10 = BDT 2,500,000. Share premium balance after rights issue was BDT 10,500,000. Since this is sufficient to cover the BDT 2,500,000 bonus issue, the entire amount is debited to Share Premium. There is no debit to Retained Earnings."
            },
            {
                question: `SCENARIO (cont.): For the year ended 31 Dec 20X3, Padma Corp. reported a profit of BDT 5,000,000 and paid a final equity dividend of BDT 1 per share. What was the closing balance of Retained Earnings?`,
                options: [
                    "BDT 17,250,000",
                    "BDT 14,750,000",
                    "BDT 19,750,000",
                    "BDT 17,500,000"
                ],
                answer: "A",
                type: "single",
                topic: "Case Study: Equity Transactions",
                explanation: "Opening RE: BDT 15,000,000. Profit: +BDT 5,000,000. Bonus issue impact on RE: BDT 0. Total shares for dividend calculation = 2,500,000 + 250,000 = 2,750,000. Dividend paid = 2,750,000 * BDT 1 = BDT 2,750,000. Closing RE = 15,000,000 + 5,000,000 - 2,750,000 = BDT 17,250,000."
            },
            // --- Case Study 1 End ---
            {
                question: "A change from the FIFO method to the weighted-average cost method for inventory valuation is considered a:",
                options: [
                    "Change in accounting estimate",
                    "Correction of a prior period error",
                    "Change in accounting policy",
                    "A non-adjusting event after the reporting period"
                ],
                answer: "C",
                type: "single",
                topic: "Regulatory Framework",
                explanation: "According to IAS 8, accounting policies are the specific principles, bases, and rules applied by an entity. The choice of inventory valuation method (FIFO vs. AVCO) is a classic example of an accounting policy. (Reference: PDF Page 385, Section 10.3)"
            },
            {
                question: "All of the following are examples of accounting estimates EXCEPT:",
                options: [
                    "The useful life of a non-current asset.",
                    "The allowance for receivables.",
                    "The decision to capitalise development costs.",
                    "The warranty obligation for products sold."
                ],
                answer: "C",
                type: "single",
                topic: "Regulatory Framework",
                explanation: "The useful life, allowance for receivables, and warranty obligations all involve judgment and estimation. The decision to capitalise development costs is an application of an accounting policy based on meeting the specific criteria in IAS 38, not an estimate. (Reference: PDF Page 385, Section 10.3)"
            },
            {
                question: "Which of the following would NOT be classified as a non-current liability?",
                options: [
                    "A 10-year bank loan with 9 years remaining until maturity.",
                    "8% Redeemable preference shares redeemable in 3 years.",
                    "A provision for a legal case expected to be settled in 18 months.",
                    "The portion of a long-term loan repayable within the next 12 months."
                ],
                answer: "D",
                type: "single",
                topic: "Non-Current Liabilities",
                explanation: "Any amount of a liability that is due for settlement within 12 months of the statement of financial position date must be reclassified from non-current to current liabilities. (Reference: PDF Page 376, Section 6)"
            },
            {
                question: "A company issues 100,000 shares of BDT 10 par value but only calls up BDT 8 per share. BDT 7 per share has been paid by shareholders. What is the 'Called-up share capital' to be shown in the Statement of Financial Position?",
                options: [
                    "BDT 1,000,000",
                    "BDT 800,000",
                    "BDT 700,000",
                    "BDT 100,000"
                ],
                answer: "B",
                type: "single",
                topic: "Share Capital",
                explanation: "The figure for share capital in the statement of financial position is the called-up share capital. In this case, it is 100,000 shares * BDT 8 = BDT 800,000. The unpaid portion (BDT 1 per share) is shown as an 'other receivable'. (Reference: PDF Page 366, Section 2.2)"
            },
            {
                question: "The primary purpose of the Share Premium account is to record:",
                options: [
                    "Profits from the sale of non-current assets.",
                    "The excess of issue price over the par value of shares.",
                    "Accumulated profits not yet distributed as dividends.",
                    "Gains from the revaluation of property, plant, and equipment."
                ],
                answer: "B",
                type: "single",
                topic: "Share Capital & Premium",
                explanation: "The share premium account is specifically used to record the premium received on the issue of shares, which is the amount by which the issue price exceeds the par (or nominal) value of the shares. (Reference: PDF Page 367, Section 3.1)"
            },
            {
                question: "Dividends paid on equity shares are accounted for by:",
                options: [
                    "Debiting an expense account in the Statement of Profit or Loss.",
                    "Crediting Retained Earnings.",
                    "Debiting Retained Earnings.",
                    "Debiting the Share Capital account."
                ],
                answer: "C",
                type: "single",
                topic: "Dividends",
                explanation: "Equity dividends are a distribution of profits to the owners, not an expense of running the business. Therefore, they are recorded as a deduction from (a debit to) the Retained Earnings account. (Reference: PDF Page 369, Section 4.1)"
            },
            {
                question: "Which of the following statements is FALSE regarding a bonus issue?",
                options: [
                    "It increases the number of shares in issue.",
                    "It increases the total equity of the company.",
                    "It can be funded from the share premium account.",
                    "It is an issue of shares free of charge to existing shareholders."
                ],
                answer: "B",
                type: "single",
                topic: "Bonus & Rights Issues",
                explanation: "A bonus issue does not change the total equity. It is simply a reclassification within equity, moving amounts from reserves (share premium or retained earnings) to share capital. Total equity remains the same. (Reference: PDF Page 372, Section 5.2)"
            },
            {
                question: "A company estimates its tax liability for the year ended 31 Dec 20X2 to be BDT 500,000. The opening balance on the tax payable account was BDT 400,000, relating to the 20X1 liability. The actual tax paid for 20X1 during 20X2 was BDT 420,000. What is the tax expense in the Statement of Profit or Loss for 20X2?",
                options: [
                    "BDT 500,000",
                    "BDT 480,000",
                    "BDT 520,000",
                    "BDT 420,000"
                ],
                answer: "C",
                type: "single",
                topic: "Tax",
                explanation: "The tax expense for the current year is the estimate for the current year plus any under-provision (or minus any over-provision) from the prior year. The prior year provision was BDT 400,000, but the actual tax was BDT 420,000, resulting in an under-provision of BDT 20,000. The tax expense for 20X2 is BDT 500,000 (current estimate) + BDT 20,000 (under-provision) = BDT 520,000. (Reference: PDF Page 381, Context Example 2)"
            },
            {
                question: "Meghna Ltd sells a product with a one-year warranty. Past experience suggests that 2% of units sold will be returned for repair, at an average cost of BDT 1,000 per unit. In 20X3, Meghna Ltd sold 10,000 units. What is the amount of the warranty provision to be created at the end of 20X3?",
                options: [
                    "BDT 20,000",
                    "BDT 10,000",
                    "BDT 200,000",
                    "BDT 1,000,000"
                ],
                answer: "C",
                type: "single",
                topic: "Provisions (IAS 37)",
                explanation: "The provision should be the best estimate of the future expenditure. Expected returns = 10,000 units * 2% = 200 units. Estimated cost = 200 units * BDT 1,000/unit = BDT 200,000. This is the amount that should be provided for. (Reference: PDF Page 378, Context Example)"
            },
            {
                question: "Which of the following is NOT a reason for IAS 1 prescribing formats for financial statements?",
                options: [
                    "To make it easier for users to find items they are interested in.",
                    "To make comparisons between different companies more meaningful.",
                    "To guarantee that the company will be profitable.",
                    "To ensure consistency in presentation from one period to the next."
                ],
                answer: "C",
                type: "single",
                topic: "Regulatory Framework",
                explanation: "IAS 1 prescribes formats to enhance comparability, understandability, and consistency. It is a presentation standard and has no bearing on the actual profitability of the company. (Reference: PDF Page 384, Section 10.1)"
            },
            {
                question: "An entity has 500,000 equity shares of BDT 10 par value and 100,000 6% irredeemable preference shares of BDT 100 par value. If the company declares and pays all dividends for the year, what is the total amount deducted from retained earnings?",
                options: [
                    "Depends on the equity dividend rate",
                    "BDT 600,000",
                    "The preference dividend of BDT 600,000 plus the total equity dividend declared.",
                    "The preference dividend is a finance cost, only the equity dividend is deducted from retained earnings."
                ],
                answer: "C",
                type: "single",
                topic: "Dividends",
                explanation: "Dividends on both equity shares and irredeemable preference shares are distributions of profit and are deducted from retained earnings. The preference dividend is 6% * (100,000 * 100) = BDT 600,000. The total deduction will be this amount plus whatever equity dividend is paid. (Reference: PDF Page 370, Section 4.2.1)"
            },
            {
                question: "A company has a loan of BDT 5,000,000, repayable in five equal annual instalments. The first instalment is due in 6 months. How should this loan be presented in the Statement of Financial Position?",
                options: [
                    "Non-current liability: BDT 5,000,000",
                    "Current liability: BDT 5,000,000",
                    "Current liability: BDT 1,000,000; Non-current liability: BDT 4,000,000",
                    "Current liability: BDT 4,000,000; Non-current liability: BDT 1,000,000"
                ],
                answer: "C",
                type: "single",
                topic: "Non-Current Liabilities",
                explanation: "The portion of the loan repayable within the next 12 months (one instalment of BDT 1,000,000) is classified as a current liability. The remaining portion (four instalments of BDT 1,000,000 each = BDT 4,000,000) is classified as a non-current liability. (Reference: PDF Page 376, Section 6)"
            },
            // --- Case Study 2 Start ---
            {
                question: `SCENARIO: Karnaphuli Traders Ltd (KTL) is preparing its financial statements for the year ended 31 Dec 20X4. The following issues are unresolved:
                1. A major customer, who owed BDT 500,000, was declared bankrupt in Nov 20X4. KTL's lawyers advise there is only a 10% chance of recovering any amount.
                2. KTL was sued by an employee in Oct 20X4 for unfair dismissal, claiming BDT 1,000,000. Lawyers believe KTL has a 75% chance of winning the case.
                What is the total charge to the Statement of Profit or Loss for these two events?`,
                options: [
                    "BDT 1,500,000",
                    "BDT 500,000",
                    "BDT 450,000",
                    "BDT 1,000,000"
                ],
                answer: "C",
                type: "single",
                topic: "Case Study: Provisions & Receivables",
                explanation: "Event 1: The receivable is impaired. The expected loss is 90% of BDT 500,000 = BDT 450,000. This should be recognized as an irrecoverable debt expense (or increase in allowance for receivables). Event 2: A provision is only made if the outflow is probable (>50%). Since KTL has a 75% chance of winning, the outflow is not probable (only 25% chance of losing). No provision is made, but a contingent liability would be disclosed. Therefore, the total charge to P/L is BDT 450,000."
            },
            {
                question: `SCENARIO (cont.): KTL sold goods worth BDT 2,000,000 to a customer on 28 Dec 20X4. Under the terms 'FOB Shipping Point', the goods were loaded onto a carrier on 30 Dec 20X4. The customer received the goods on 3 Jan 20X5. When should KTL recognise the revenue according to IFRS 15?`,
                options: [
                    "28 Dec 20X4",
                    "30 Dec 20X4",
                    "31 Dec 20X4",
                    "3 Jan 20X5"
                ],
                answer: "B",
                type: "single",
                topic: "Case Study: Revenue Recognition",
                explanation: "'FOB Shipping Point' means control of the goods transfers to the buyer when the goods are passed to the carrier. Therefore, KTL satisfied its performance obligation on 30 Dec 20X4, and revenue should be recognised on that date. The date of receipt by the customer is irrelevant in this case. (Reference: IFRS 15 principles, PDF Page 382)"
            },
            // --- Case Study 2 End ---
            {
                question: "The purpose of a 'rights issue' is to:",
                options: [
                    "Reward existing shareholders without raising cash.",
                    "Raise new cash from existing shareholders.",
                    "Reduce the number of shares in circulation.",
                    "Convert debt into equity."
                ],
                answer: "B",
                type: "single",
                topic: "Bonus & Rights Issues",
                explanation: "A rights issue is a method for a company to raise additional capital by offering new shares to its existing shareholders, who have the 'right' to purchase them before they are offered to the public. (Reference: PDF Page 371, Section 5.1)"
            },
            {
                question: "Which of the following would cause a company's total equity to decrease? (Choose TWO correct answers)",
                options: [
                    "A 1 for 2 bonus issue from retained earnings.",
                    "Payment of an equity dividend.",
                    "Incurring a loss for the period.",
                    "A 1 for 4 rights issue at a premium."
                ],
                answer: ["B", "C"],
                type: "multiple",
                topic: "Equity Movements",
                explanation: "Payment of a dividend is a distribution of assets to owners, reducing equity (retained earnings). A loss for the period reduces retained earnings, thus reducing total equity. A bonus issue is a reclassification within equity and has no effect on the total. A rights issue increases equity as new cash is raised. (Reference: PDF Page 368, Retained Earnings T-account)"
            },
            {
                question: "If a company has called-up share capital of BDT 1,000,000 but shareholders have only paid BDT 950,000, the BDT 50,000 difference is shown as:",
                options: [
                    "A reduction in share capital.",
                    "A current liability.",
                    "An 'other receivable'.",
                    "A debit to retained earnings."
                ],
                answer: "C",
                type: "single",
                topic: "Share Capital",
                explanation: "The unpaid capital is an amount owed to the company by its shareholders. It is therefore treated as a receivable (an asset) in the statement of financial position. The share capital figure remains at the called-up amount. (Reference: PDF Page 366, Context Example: Paid up capital)"
            },
            {
                question: "All of the following are valid uses of the share premium account EXCEPT:",
                options: [
                    "Funding a bonus issue of shares.",
                    "Paying dividends to shareholders.",
                    "Writing off the expenses of a share issue.",
                    "Writing off any premium paid on redemption of debentures."
                ],
                answer: "B",
                type: "single",
                topic: "Share Capital & Premium",
                explanation: "There are strict legal restrictions on the use of the share premium account. It cannot be used to pay dividends, as this would be a return of capital. It can be used for bonus issues and to write off share issue expenses. (Reference: PDF Page 368, Section 3.1)"
            },
            {
                question: "A company's trial balance shows '8% Debentures BDT 2,000,000'. The interest for the full year has been paid. The correct accounting treatment is:",
                options: [
                    "A finance cost of BDT 160,000 in the Statement of Profit or Loss.",
                    "A deduction of BDT 160,000 from Retained Earnings.",
                    "A current asset of BDT 160,000.",
                    "No entry is needed as the interest is already paid."
                ],
                answer: "A",
                type: "single",
                topic: "Non-Current Liabilities",
                explanation: "Interest on debt is a finance cost and must be shown as an expense in the Statement of Profit or Loss for the period, regardless of whether it has been paid. The interest is 8% of BDT 2,000,000 = BDT 160,000. (Reference: PDF Page 376, Section 6)"
            },
            {
                question: "The concept that requires financial statements to show comparative figures for the previous reporting period is a key requirement of:",
                options: [
                    "IFRS 15",
                    "IAS 37",
                    "IAS 8",
                    "IAS 1"
                ],
                answer: "D",
                type: "single",
                topic: "Regulatory Framework",
                explanation: "IAS 1, Presentation of Financial Statements, requires comparative information to be disclosed in respect of the previous period for all amounts reported in the current period's financial statements. This enhances comparability. (Reference: PDF Page 384, Section 10.1)"
            },
            {
                question: "Which of the following is an example of a 'present obligation' that could lead to a provision under IAS 37?",
                options: [
                    "A plan to restructure a division of the business in the future.",
                    "A lawsuit filed against the company where an outflow of cash is probable.",
                    "A general desire to provide for future operating losses.",
                    "A possible, but not probable, environmental clean-up cost."
                ],
                answer: "B",
                type: "single",
                topic: "Provisions (IAS 37)",
                explanation: "A present obligation arises from a past event. A lawsuit filed against the company creates a present obligation. If the outflow is probable, a provision is required. Future plans or possible obligations do not meet the criteria for a provision. (Reference: PDF Page 377, Section 7)"
            },
            {
                question: "A company has 400,000 equity shares of 50 paisa each. The equity share capital account would show a balance of:",
                options: [
                    "BDT 400,000",
                    "BDT 200,000",
                    "BDT 800,000",
                    "BDT 50"
                ],
                answer: "B",
                type: "single",
                topic: "Share Capital",
                explanation: "The balance in the share capital account is the total par value of the shares issued. 400,000 shares * BDT 0.50 (50 paisa) = BDT 200,000. (Reference: PDF Page 369, Context Example)"
            },
            {
                question: "True or False: A bonus issue dilutes the ownership percentage of existing shareholders.",
                options: [
                    "True",
                    "False"
                ],
                answer: "B",
                type: "single",
                topic: "Bonus & Rights Issues",
                explanation: "False. A bonus issue is made in proportion to existing shareholdings. Therefore, each shareholder's percentage of ownership in the company remains exactly the same after the issue. (Reference: PDF Page 372, Section 5.2)"
            },
            {
                question: "The distinction between current and non-current items in the Statement of Financial Position is based on a time frame of:",
                options: [
                    "6 months from the reporting date.",
                    "The company's operating cycle.",
                    "12 months from the reporting date.",
                    "24 months from the reporting date."
                ],
                answer: "C",
                type: "single",
                topic: "Regulatory Framework",
                explanation: "IAS 1 requires the classification of assets and liabilities as current or non-current. An item is current if it is expected to be settled or realised within 12 months after the reporting period. (Reference: PDF Page 384, Section 10.2)"
            },
            {
                question: "When a company releases an excess provision from a prior year:",
                options: [
                    "It increases expenses in the current year.",
                    "It is credited to the relevant expense account, reducing current year expenses.",
                    "It is credited directly to retained earnings.",
                    "It is credited to the share premium account."
                ],
                answer: "B",
                type: "single",
                topic: "Provisions (IAS 37)",
                explanation: "If a provision is found to be excessive, the excess amount is released. The journal entry is a debit to the provision (liability) and a credit to the relevant expense account in the Statement of Profit or Loss, which has the effect of increasing profit for the current period. (Reference: PDF Page 378, Section 7.1, Stage 3)"
            },
            {
                question: "Which of the following would be presented as 'Finance Income' or 'Investment Income' in the Statement of Profit or Loss?",
                options: [
                    "Profit on the disposal of a non-current asset.",
                    "Revenue from the primary activities of the business.",
                    "Dividends received from an investment in another company.",
                    "A refund received from a supplier."
                ],
                answer: "C",
                type: "single",
                topic: "Revenue (IFRS 15)",
                explanation: "Income such as interest received and dividends received from investments are not part of the main revenue from ordinary activities. They are presented separately, typically as 'finance income' or 'investment income'. (Reference: PDF Page 382, Note 2)"
            },
            {
                question: "What is the effect of a rights issue on the net assets of a company?",
                options: [
                    "Net assets increase.",
                    "Net assets decrease.",
                    "Net assets remain unchanged.",
                    "The effect depends on the issue price."
                ],
                answer: "A",
                type: "single",
                topic: "Bonus & Rights Issues",
                explanation: "A rights issue involves issuing new shares for cash. This cash inflow increases the company's assets (cash) while also increasing equity. Therefore, the net assets (Assets - Liabilities) of the company increase by the amount of cash raised. (Reference: PDF Page 371, Section 5.1)"
            },
            {
                question: "An 'under-provision' of tax is when the estimated tax for a prior period was __________ the actual amount.",
                options: [
                    "equal to",
                    "higher than",
                    "less than",
                    "unrelated to"
                ],
                answer: "C",
                type: "single",
                topic: "Tax",
                explanation: "An under-provision occurs when the tax expense estimated in a previous period's financial statements proves to be too low (less than) the amount finally agreed with the tax authorities (e.g., NBR in Bangladesh). (Reference: PDF Page 381, Section 8.1)"
            },
            {
                question: "Choose the correct statement regarding companies in Bangladesh.",
                options: [
                    "A private company can offer its shares for sale to the general public.",
                    "A public company must end its name with 'Limited' or 'Ltd'.",
                    "A private company cannot offer its securities for sale to the public at large.",
                    "There is no legal distinction between public and private companies."
                ],
                answer: "C",
                type: "single",
                topic: "Nature of a Limited Company",
                explanation: "A key distinction under the Companies Act 1994 is that private companies are prohibited from making any invitation to the public to subscribe for their shares or debentures. Public companies (ending in 'Public Limited Company' or 'PLC') can offer their securities to the public. (Reference: PDF Page 365, Section 1.2, adapted for Bangladesh Companies Act 1994)"
            },
            {
                question: "The double entry for the repayment of a debenture (loan stock) at its par value is:",
                options: [
                    "Debit Cash, Credit Non-current liabilities",
                    "Debit Non-current liabilities, Credit Cash",
                    "Debit Retained Earnings, Credit Cash",
                    "Debit Non-current liabilities, Credit Share Capital"
                ],
                answer: "B",
                type: "single",
                topic: "Non-Current Liabilities",
                explanation: "Repaying a loan reduces the company's liability and its cash. Therefore, the non-current liability account is debited to decrease it, and the cash account is credited to decrease the asset. (Reference: PDF Page 376, Section 6.1)"
            },
            {
                question: "Which of the following events would result in a debit to the Share Premium account?",
                options: [
                    "A rights issue of shares at a price above par value.",
                    "Payment of a dividend.",
                    "A bonus issue of shares.",
                    "An upward revaluation of a non-current asset."
                ],
                answer: "C",
                type: "single",
                topic: "Share Capital & Premium",
                explanation: "One of the few permitted uses of the Share Premium account is to fund a bonus issue. This involves debiting Share Premium and crediting Share Capital, effectively converting the premium into capital. (Reference: PDF Page 372, Section 5.2)"
            },
            {
                question: "According to the PDF, which TWO of the following are key sources of accounting regulations for companies?",
                options: [
                    "Stock exchange listing rules",
                    "Accounting standards (e.g., IFRS)",
                    "Internal company policies",
                    "Legislation (e.g., Companies Act 1994)"
                ],
                answer: ["B", "D"],
                type: "multiple",
                topic: "Regulatory Framework",
                explanation: "The text explicitly states that the main sources of accounting regulations for companies are accounting standards (IFRS) and legislation, such as the Companies Act. (Reference: PDF Page 384, Section 10)"
            },
            {
                question: "According to IAS 8, which of the following is considered a change in accounting policy, requiring retrospective restatement?",
                options: [
                    "Changing the estimated useful life of a machine from 10 years to 8 years.",
                    "Revising the warranty provision based on new claims data.",
                    "Changing the inventory valuation method from weighted-average cost to FIFO.",
                    "Increasing the allowance for doubtful debts from 2% to 3% of receivables."
                ],
                answer: "C",
                type: "single",
                topic: "Regulatory Framework",
                explanation: "A change in inventory valuation method is a change in accounting policy under IAS 8. Changes in useful life, provisions, and allowances are changes in accounting estimates, which are applied prospectively. (Reference: PDF Page 385, Section 10.3)"
            },
            {
                question: "A company has BDT 1,000,000 of 8% redeemable preference shares and BDT 2,000,000 of equity shares. During the year, it declared and paid the full preference dividend and an equity dividend of BDT 100,000. What is the total impact on the financial statements?",
                options: [
                    "A charge of BDT 180,000 to the Statement of Profit or Loss.",
                    "A deduction of BDT 180,000 from Retained Earnings.",
                    "A finance cost of BDT 80,000 in the P/L and a deduction of BDT 100,000 from Retained Earnings.",
                    "A finance cost of BDT 100,000 in the P/L and a deduction of BDT 80,000 from Retained Earnings."
                ],
                answer: "C",
                type: "single",
                topic: "Dividends",
                explanation: "Dividends on redeemable preference shares are treated as a finance cost. 8% of BDT 1,000,000 = BDT 80,000, which is an expense in the P/L. Equity dividends are a distribution of profit, so BDT 100,000 is deducted from Retained Earnings. (Reference: PDF Page 370, Section 4.2.2)"
            }
        ];

        let currentQuestionIndex = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let flaggedQuestions = new Array(quizData.length).fill(false);
        let timerInterval;
        let timeRemaining = 45 * 60; // 45 minutes in seconds

        const quizContainer = document.getElementById('quiz-container');
        const resultsContainer = document.getElementById('results-container');
        const questionTracker = document.getElementById('question-tracker');
        const questionNumberEl = document.getElementById('question-number');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const flagBtn = document.getElementById('flag-btn');
        const submitBtn = document.getElementById('submit-btn');
        const retakeBtn = document.getElementById('retake-btn');
        const timerEl = document.getElementById('timer');
        
        // Modal elements
        const confirmModal = document.getElementById('confirm-modal');
        const modalText = document.getElementById('modal-text');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');


        function startQuiz() {
            populateQuestionTracker();
            displayQuestion(currentQuestionIndex);
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function populateQuestionTracker() {
            questionTracker.innerHTML = '';
            quizData.forEach((_, index) => {
                const trackerItem = document.createElement('div');
                trackerItem.textContent = index + 1;
                trackerItem.classList.add('question-tracker-item', 'w-10', 'h-10', 'flex', 'items-center', 'justify-center', 'font-semibold', 'border', 'rounded-md');
                updateTrackerItemState(trackerItem, index);
                trackerItem.addEventListener('click', () => {
                    currentQuestionIndex = index;
                    displayQuestion(currentQuestionIndex);
                });
                questionTracker.appendChild(trackerItem);
            });
        }

        function updateTrackerItemState(item, index) {
            item.classList.remove('bg-white', 'text-gray-800', 'bg-green-500', 'text-white', 'bg-orange-500', 'border-blue-500', 'border-gray-300');
            
            if (flaggedQuestions[index]) {
                item.classList.add('bg-orange-500', 'text-white');
            } else if (userAnswers[index] !== null) {
                item.classList.add('bg-green-500', 'text-white');
            } else {
                item.classList.add('bg-white', 'text-gray-800');
            }

            if (index === currentQuestionIndex) {
                item.classList.add('border-blue-500', 'border-2');
            } else {
                 item.classList.add('border-gray-300');
            }
        }

        function displayQuestion(index) {
            const question = quizData[index];
            questionNumberEl.textContent = `Question ${index + 1} of ${quizData.length}`;
            questionTextEl.innerHTML = question.question.replace(/SCENARIO: |SCENARIO \(cont.\): /g, '<span class="font-bold text-blue-700 block mb-2">$&</span>');
            optionsContainer.innerHTML = '';

            const inputType = question.type === 'multiple' ? 'checkbox' : 'radio';
            
            question.options.forEach((option, i) => {
                const optionId = `q${index}_option${i}`;
                const optionChar = String.fromCharCode(65 + i);

                const wrapper = document.createElement('div');
                const input = document.createElement('input');
                input.type = inputType;
                input.id = optionId;
                input.name = `q${index}_options`;
                input.value = optionChar;
                input.className = 'hidden';

                const label = document.createElement('label');
                label.htmlFor = optionId;
                label.className = 'option-label';
                label.textContent = `${optionChar}. ${option}`;

                if (question.type === 'single' && userAnswers[index] === optionChar) {
                    label.classList.add('selected');
                } else if (question.type === 'multiple' && userAnswers[index] && userAnswers[index].includes(optionChar)) {
                    label.classList.add('selected');
                }

                input.addEventListener('change', () => handleOptionSelect(index, optionChar, inputType));

                wrapper.appendChild(input);
                wrapper.appendChild(label);
                optionsContainer.appendChild(wrapper);
            });
            
            updateNavigationButtons();
            updateFlagButton();
            updateAllTrackerItems();
        }

        function handleOptionSelect(qIndex, optionChar, type) {
            if (type === 'radio') {
                userAnswers[qIndex] = optionChar;
                document.querySelectorAll(`input[name="q${qIndex}_options"]`).forEach(radio => {
                    document.querySelector(`label[for="${radio.id}"]`).classList.remove('selected');
                });
                document.querySelector(`label[for="q${qIndex}_option${optionChar.charCodeAt(0) - 65}"]`).classList.add('selected');

            } else { // checkbox
                if (!userAnswers[qIndex]) {
                    userAnswers[qIndex] = [];
                }
                const label = document.querySelector(`label[for="q${qIndex}_option${optionChar.charCodeAt(0) - 65}"]`);
                if (userAnswers[qIndex].includes(optionChar)) {
                    userAnswers[qIndex] = userAnswers[qIndex].filter(ans => ans !== optionChar);
                    label.classList.remove('selected');
                } else {
                    userAnswers[qIndex].push(optionChar);
                    label.classList.add('selected');
                }
                if (userAnswers[qIndex].length === 0) {
                    userAnswers[qIndex] = null;
                } else {
                    userAnswers[qIndex].sort();
                }
            }
            updateAllTrackerItems();
        }

        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            prevBtn.classList.toggle('opacity-50', prevBtn.disabled);
            nextBtn.disabled = currentQuestionIndex === quizData.length - 1;
            nextBtn.classList.toggle('opacity-50', nextBtn.disabled);
        }

        function updateFlagButton() {
            if (flaggedQuestions[currentQuestionIndex]) {
                flagBtn.textContent = 'Unflag Question';
                flagBtn.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                flagBtn.classList.add('bg-gray-500', 'hover:bg-gray-600');
            } else {
                flagBtn.textContent = 'Flag for Review';
                flagBtn.classList.add('bg-orange-500', 'hover:bg-orange-600');
                flagBtn.classList.remove('bg-gray-500', 'hover:bg-gray-600');
            }
        }

        function updateAllTrackerItems() {
            const items = document.querySelectorAll('.question-tracker-item');
            items.forEach((item, index) => {
                updateTrackerItemState(item, index);
            });
        }

        function submitQuiz() {
            clearInterval(timerInterval);
            quizContainer.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
            calculateAndDisplayResults();
        }

        function calculateAndDisplayResults() {
            let correctCount = 0;
            const topicMistakes = {};

            quizData.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                let isCorrect = false;

                if (question.type === 'single') {
                    if (userAnswer === question.answer) {
                        isCorrect = true;
                    }
                } else { // multiple
                    // Sort both arrays to ensure comparison is accurate regardless of selection order
                    const sortedUserAnswer = userAnswer ? [...userAnswer].sort() : null;
                    const sortedCorrectAnswer = [...question.answer].sort();
                    if (JSON.stringify(sortedUserAnswer) === JSON.stringify(sortedCorrectAnswer)) {
                        isCorrect = true;
                    }
                }

                if (isCorrect) {
                    correctCount++;
                } else {
                    if (topicMistakes[question.topic]) {
                        topicMistakes[question.topic]++;
                    } else {
                        topicMistakes[question.topic] = 1;
                    }
                }
                
                displayResultForQuestion(index, isCorrect);
            });

            const totalQuestions = quizData.length;
            const incorrectCount = totalQuestions - correctCount;
            const score = correctCount * 2;
            const incorrectPercentage = totalQuestions > 0 ? ((incorrectCount / totalQuestions) * 100).toFixed(1) : 0;

            document.getElementById('total-score').textContent = `${score} / ${totalQuestions * 2}`;
            document.getElementById('correct-answers').textContent = `${correctCount} / ${totalQuestions}`;
            document.getElementById('incorrect-answers').textContent = `${incorrectCount} / ${totalQuestions}`;
            document.getElementById('incorrect-percentage').textContent = `${incorrectPercentage}%`;

            const improvementAreasEl = document.getElementById('improvement-areas');
            improvementAreasEl.innerHTML = '';
            const sortedMistakes = Object.entries(topicMistakes).sort(([,a],[,b]) => b-a);
            
            if (sortedMistakes.length > 0) {
                sortedMistakes.forEach(([topic, count]) => {
                    const li = document.createElement('li');
                    li.textContent = `${topic} (${count} incorrect)`;
                    improvementAreasEl.appendChild(li);
                });
            } else {
                improvementAreasEl.innerHTML = '<li>Excellent work! No specific areas for improvement identified.</li>';
            }
        }

        function displayResultForQuestion(index, isCorrect) {
            const question = quizData[index];
            const userAnswer = userAnswers[index];
            const resultDiv = document.createElement('div');
            resultDiv.className = `p-4 rounded-lg shadow-sm ${isCorrect ? 'correct' : 'incorrect'}`;

            let userAnswerText = 'Not Answered';
            if (userAnswer) {
                userAnswerText = Array.isArray(userAnswer) ? userAnswer.join(', ') : userAnswer;
            }
            
            const correctAnswerText = Array.isArray(question.answer) ? question.answer.join(', ') : question.answer;

            resultDiv.innerHTML = `
                <p class="font-bold mb-2">Question ${index + 1}: ${question.question.replace(/<span class="font-bold text-blue-700 block mb-2">/g, '').replace(/<\/span>/g, '')}</p>
                <p class="mb-1">Your Answer: <span class="user-answer">${userAnswerText}</span></p>
                <p class="mb-3">Correct Answer: <span class="correct-answer">${correctAnswerText}</span></p>
                <div class="bg-gray-50 p-3 rounded-md mt-2">
                    <p class="font-semibold text-sm text-gray-700">ðŸ“– Explanation:</p>
                    <p class="text-sm text-gray-600">${question.explanation}</p>
                </div>
            `;
            document.getElementById('results-section').appendChild(resultDiv);
        }

        // Event Listeners
        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion(currentQuestionIndex);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                displayQuestion(currentQuestionIndex);
            }
        });

        flagBtn.addEventListener('click', () => {
            flaggedQuestions[currentQuestionIndex] = !flaggedQuestions[currentQuestionIndex];
            updateFlagButton();
            updateAllTrackerItems();
        });
        
        // --- MODIFIED SUBMIT BUTTON LOGIC ---
        submitBtn.addEventListener('click', () => {
            const unanswered = userAnswers.filter(a => a === null).length;
            if (unanswered > 0) {
                modalText.textContent = `You have ${unanswered} unanswered questions. Are you sure you want to submit?`;
            } else {
                modalText.textContent = `Are you sure you want to submit your quiz?`;
            }
            confirmModal.classList.remove('hidden');
        });

        modalCancelBtn.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
        });

        modalConfirmBtn.addEventListener('click', () => {
            confirmModal.classList.add('hidden');
            submitQuiz();
        });
        // --- END OF MODIFIED LOGIC ---

        retakeBtn.addEventListener('click', () => {
            window.location.reload();
        });

        // Initial call
        startQuiz();

    </script>
</body>
</html>
