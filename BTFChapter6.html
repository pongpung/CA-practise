<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICAB Exam Style Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .quiz-container {
            max-width: 1200px;
            margin: auto;
        }
        .btn {
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .question-tracker-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .qt-unattempted { background-color: #e2e8f0; color: #4a5568; }
        .qt-attempted { background-color: #c6f6d5; color: #2f855a; }
        .qt-flagged { background-color: #fed7d7; color: #c53030; }
        .qt-current { box-shadow: 0 0 0 3px #4299e1; }

        /* Custom scrollbar for better aesthetics */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* For result screen answer highlighting */
        .correct-answer { background-color: #c6f6d5 !important; border-left: 4px solid #38a169; }
        .incorrect-answer { background-color: #fed7d7 !important; border-left: 4px solid #e53e3e; }
        .missed-correct-answer { background-color: #ebf8ff; border-left: 4px solid #3182ce; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Main Container -->
    <div class="quiz-container p-4 md:p-8">

        <!-- Home Page -->
        <div id="home-page" class="text-center bg-white p-8 rounded-xl shadow-lg">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-700">ICAB – Business, Technology and Finance</h1>
            <h2 class="text-xl md:text-2xl font-semibold text-blue-600 mt-2">Chapter: The Finance Function and Financial Information</h2>
            <p class="mt-6 text-gray-600 max-w-2xl mx-auto">
                This is a 50-question quiz designed in the ICAB exam style. You will have <strong>45 minutes</strong> to complete it. 
                The quiz includes various question types to test your understanding of the chapter.
            </p>
            <button id="start-quiz-btn" class="btn mt-8 bg-blue-600 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-md hover:bg-blue-700">
                Start Quiz
            </button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Left Side: Question Tracker -->
                <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-lg font-bold mb-4 text-center">Question Tracker</h3>
                    <div id="question-tracker" class="grid grid-cols-5 gap-3">
                        <!-- Tracker buttons will be generated by JS -->
                    </div>
                    <div class="mt-6 space-y-2 text-sm">
                        <div class="flex items-center"><div class="w-4 h-4 rounded-full bg-c6f6d5 border border-gray-300 mr-2"></div> Attempted</div>
                        <div class="flex items-center"><div class="w-4 h-4 rounded-full bg-e2e8f0 border border-gray-300 mr-2"></div> Unattempted</div>
                        <div class="flex items-center"><div class="w-4 h-4 rounded-full bg-fed7d7 border border-gray-300 mr-2"></div> Flagged</div>
                    </div>
                </div>

                <!-- Right Side: Quiz Content -->
                <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center border-b pb-4 mb-4">
                        <h2 class="text-xl font-bold">Question <span id="question-number">1</span>/50</h2>
                        <div class="flex items-center space-x-4">
                            <div id="timer" class="text-xl font-bold bg-gray-100 text-gray-700 px-4 py-2 rounded-lg">45:00</div>
                            <button id="flag-btn" class="btn bg-orange-100 text-orange-600 px-4 py-2 rounded-lg font-semibold hover:bg-orange-200">
                                <i class="fas fa-flag"></i> Flag This Question
                            </button>
                        </div>
                    </div>
                    
                    <div id="question-container">
                        <p id="question-text" class="text-lg font-medium mb-4"></p>
                        <div id="question-type-info" class="text-sm text-blue-600 bg-blue-50 p-2 rounded-md mb-4"></div>
                        <div id="options-container" class="space-y-3">
                            <!-- Options will be generated by JS -->
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button id="prev-btn" class="btn bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-400">Previous</button>
                        <button id="next-btn" class="btn bg-blue-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-700">Next</button>
                        <button id="submit-btn" class="btn hidden bg-green-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-green-700">Submit Quiz</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden bg-white p-8 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold text-center mb-2">Quiz Results</h2>
            <p class="text-center text-gray-600 mb-6">You have completed the quiz.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-8">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <div class="text-4xl font-bold text-blue-600" id="score-percentage">0%</div>
                    <div class="text-gray-600">Score</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <div class="text-4xl font-bold text-green-600" id="correct-answers">0</div>
                    <div class="text-gray-600">Correct</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg">
                    <div class="text-4xl font-bold text-red-600" id="incorrect-answers">0</div>
                    <div class="text-gray-600">Incorrect</div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3"><i class="fas fa-book-open mr-2"></i>Topics to Review</h3>
                    <ul id="topics-to-review" class="list-disc list-inside space-y-1 text-gray-700">
                        <!-- Topics will be generated by JS -->
                    </ul>
                </div>
                 <div class="bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold mb-3"><i class="fas fa-chart-line mr-2"></i>Performance Summary</h3>
                    <p><strong>Chapter Coverage:</strong> <span id="chapter-coverage"></span> of the key topics were tested.</p>
                    <p><strong>Total XP Gained:</strong> <span id="xp-gained" class="font-bold text-purple-600">0 XP</span></p>
                    <p><strong>Your Level:</strong> <span id="user-level" class="font-bold text-purple-600"></span></p>
                    <p class="mt-2 text-sm text-gray-500">Performance is tracked in your browser. Try again to beat your score!</p>
                </div>
            </div>
            
            <h3 class="text-2xl font-bold mb-4 text-center">Detailed Answer Review</h3>
             <div class="text-center mb-4">
                <button id="review-all-btn" class="btn bg-gray-200 px-4 py-2 rounded-md">All</button>
                <button id="review-correct-btn" class="btn bg-gray-200 px-4 py-2 rounded-md">Correct</button>
                <button id="review-incorrect-btn" class="btn bg-gray-200 px-4 py-2 rounded-md">Incorrect</button>
                <button id="review-flagged-btn" class="btn bg-gray-200 px-4 py-2 rounded-md">Flagged</button>
            </div>
            <div id="detailed-review" class="space-y-4 max-h-[60vh] overflow-y-auto custom-scrollbar pr-2">
                <!-- Detailed review will be generated by JS -->
            </div>
            <div class="text-center mt-8">
                <button id="retake-quiz-btn" class="btn bg-blue-600 text-white font-bold py-3 px-8 rounded-lg text-lg">Retake Quiz</button>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>Prepared by:</p>
            <p class="font-semibold">K. M. Mahafuzul Alam</p>
            <div class="flex justify-center items-center space-x-4 mt-2">
                <a href="https://www.linkedin.com/in/k-m-mahafuzul-alam" target="_blank" class="hover:text-blue-600"><i class="fab fa-linkedin"></i> LinkedIn</a>
                <span>|</span>
                <span><i class="fas fa-phone"></i> 01728-928984</span>
                <span>|</span>
                <span><i class="fas fa-envelope"></i> kmmhafuzulalam@gmail.com</span>
            </div>
        </footer>

    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center">
            <h3 class="text-xl font-bold mb-4">Are you sure?</h3>
            <p id="modal-text" class="text-gray-600 mb-6">Do you really want to submit your quiz?</p>
            <div class="flex justify-center space-x-4">
                <button id="modal-cancel-btn" class="btn bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-lg">Cancel</button>
                <button id="modal-confirm-btn" class="btn bg-red-600 text-white font-bold py-2 px-6 rounded-lg">Confirm</button>
            </div>
        </div>
    </div>


    <script>
        // --- QUIZ DATA ---
        // Generated based on the provided PDF "The finance function and financial information"
        const quizData = [
            {
                id: 1,
                question: "Which of the following are the four specific, but often interrelated, tasks of the finance function as defined in the chapter?",
                options: [
                    "Marketing, Sales, HR, and Operations",
                    "Recording financial transactions, Management accounting, Financial reporting, and Treasury management",
                    "Auditing, Tax compliance, Legal affairs, and Investor relations",
                    "Strategic planning, Product development, Customer service, and Supply chain management"
                ],
                answer: "Recording financial transactions, Management accounting, Financial reporting, and Treasury management",
                type: "single",
                explanation: "The chapter explicitly defines the four specific tasks of the finance function as: Recording financial transactions, Management accounting, Financial reporting, and Treasury management.",
                topic: "What does the finance function do?",
                isTricky: false
            },
            {
                id: 2,
                question: "In the context of 'Business Partnering', the finance function provides support to other business areas. Which of the following are examples of support provided to the 'operations/production' function? (Select 2)",
                options: [
                    "Analysis of sales volumes and advice on pricing",
                    "Variance analysis to identify reasons behind cost changes per unit",
                    "Project appraisal for new research areas",
                    "Decision support for new products or closing down operations"
                ],
                answer: ["Variance analysis to identify reasons behind cost changes per unit", "Decision support for new products or closing down operations"],
                type: "multiple",
                explanation: "The text states that for operations/production, the finance function provides support through variance analysis and decision support for new products or operational closures. Analysis of sales volumes is for marketing, and project appraisal is for R&D.",
                topic: "Business Partnering",
                isTricky: false
            },
            {
                id: 3,
                question: "A potential dilemma in business partnering is that a finance business partner may get too close to business function managers. This could potentially lead to:",
                options: [
                    "Improved communication and faster decision-making",
                    "Subverting governance processes through misreporting and sidestepping controls",
                    "Increased budget allocation for the finance function",
                    "Better alignment of financial and operational goals"
                ],
                answer: "Subverting governance processes through misreporting and sidestepping controls",
                type: "single",
                explanation: "The chapter highlights a key dilemma: getting too close to business function managers may compromise objectivity and independence, potentially leading to the subversion of governance and controls.",
                topic: "Business Partnering",
                isTricky: true
            },
            {
                id: 4,
                question: "The structure of a business's finance function is affected by several factors. Which of the following is NOT listed as a factor?",
                options: [
                    "Its technology (e.g., cloud accounting)",
                    "Its markets and geographical dispersion",
                    "The number of competitors in the industry",
                    "Its culture and history"
                ],
                answer: "The number of competitors in the industry",
                type: "single",
                explanation: "The chapter lists business structure, organisational structure, size, dispersion, markets, technology, history, ownership, and culture as factors. The number of competitors is an external market factor but not explicitly listed as a direct influence on the internal finance function structure.",
                topic: "Structure of the finance function",
                isTricky: false
            },
            {
                id: 5,
                question: "Financial information is used by businesses and managers for several key purposes. Which option correctly lists these purposes?",
                options: [
                    "Planning, controlling, recording transactions, and performance measurement",
                    "Marketing, innovation, and customer retention",
                    "Hiring, training, and employee compensation",
                    "All of the above"
                ],
                answer: "Planning, controlling, recording transactions, and performance measurement",
                type: "single",
                explanation: "Section 4.1 clearly states that businesses and managers require financial information for planning, controlling, recording transactions, and performance measurement.",
                topic: "Uses and types of financial information",
                isTricky: false
            },
            {
                id: 6,
                question: "According to the IFRS Conceptual Framework, who are the 'primary users' of financial information?",
                options: [
                    "Employees and The public",
                    "Governments and their agencies",
                    "Present and potential investors, lenders and other payables",
                    "Customers and Suppliers"
                ],
                answer: "Present and potential investors, lenders and other payables",
                type: "single",
                explanation: "The chapter identifies 'Present and potential investors' and 'Lenders and other payables' as the primary users of financial information according to the IFRS Framework.",
                topic: "Users of financial information",
                isTricky: false
            },
            {
                id: 7,
                question: "The IFRS Framework identifies two fundamental qualitative characteristics that make financial information useful. What are they?",
                options: [
                    "Comparability and Verifiability",
                    "Timeliness and Understandability",
                    "Relevance and Faithful representation",
                    "Cost constraint and Materiality"
                ],
                answer: "Relevance and Faithful representation",
                type: "single",
                explanation: "Section 5.5 states that the two fundamental qualitative characteristics are Relevance and Faithful representation. The others listed are enhancing characteristics.",
                topic: "Qualitative characteristics of financial information",
                isTricky: false
            },
            {
                id: 8,
                question: "A piece of information is considered ________ if omitting it or misstating it could influence decisions that users make.",
                options: [
                    "verifiable",
                    "material",
                    "timely",
                    "prudent"
                ],
                answer: "material",
                type: "fill-in-the-blank",
                explanation: "The definition of materiality is that information is material if its omission or misstatement could influence user decisions. It's an entity-specific aspect of relevance.",
                topic: "Qualitative characteristics of financial information",
                isTricky: false
            },
            {
                id: 9,
                question: "Which of the following are listed as limitations of financial information in meeting users' needs? (Select 3)",
                options: [
                    "It is too detailed and specific.",
                    "Its presentation is standardised and aggregated.",
                    "It is backward-looking.",
                    "It omits non-financial information."
                ],
                answer: ["Its presentation is standardised and aggregated.", "It is backward-looking.", "It omits non-financial information."],
                type: "multiple",
                explanation: "The chapter outlines three main limitations: being standardised and aggregated, being inherently historical (backward-looking), and omitting important non-financial information.",
                topic: "Limitations of financial information",
                isTricky: false
            },
            {
                id: 10,
                question: "The acronym CATIVA represents criteria for effective information processing. What does the 'A' in CATIVA stand for?",
                options: [
                    "Authenticity",
                    "Accuracy",
                    "Automation",
                    "Authorization"
                ],
                answer: "Accuracy",
                type: "single",
                explanation: "CATIVA stands for Completeness, Accuracy, Timeliness, Inalterability, Verifiability, and Assessability. Therefore, 'A' stands for Accuracy.",
                topic: "Information processing and management",
                isTricky: false
            },
            {
                id: 11,
                question: "A _________ converts data from mainly internal sources into information (e.g., summary reports) that enables managers to make timely and effective decisions for planning and control.",
                options: [
                    "Transaction Processing System (TPS)",
                    "Management Information System (MIS)",
                    "Human Resources System",
                    "Distributed Ledger Technology (DLT)"
                ],
                answer: "Management Information System (MIS)",
                type: "fill-in-the-blank",
                explanation: "The definition of a Management Information System (MIS) is that it converts data from internal sources (often from a TPS) into information for managers to use in decision-making.",
                topic: "Information processing and management",
                isTricky: false
            },
            {
                id: 12,
                question: "The acronym ACIANA describes the qualities of a secure information system. Which quality ensures that data is the same as in its sources and has not been accidentally or deliberately altered?",
                options: [
                    "Availability",
                    "Confidentiality",
                    "Integrity",
                    "Authenticity"
                ],
                answer: "Integrity",
                type: "single",
                explanation: "Integrity is the quality that ensures data has not been altered, destroyed, or disclosed in an unauthorized manner, maintaining its original state.",
                topic: "Information security",
                isTricky: false
            },
            {
                id: 13,
                question: "A company implements a control where the system checks that a value entered into a field (e.g., a ledger account number) must be between 5,000 and 9,999. What type of data validation check is this?",
                options: [
                    "Check digit",
                    "Control total",
                    "Limit check",
                    "Range check"
                ],
                answer: "Range check",
                type: "single",
                explanation: "A range check is used to validate that a value entered falls within a sensible, predefined lower and upper bound, as described in the scenario.",
                topic: "Information security",
                isTricky: false
            },
            {
                id: 14,
                question: "Segregation of duties is a core security requirement. It involves dividing responsibilities into separate roles to prevent abuse of power. Which of the following is an example of roles that should be segregated?",
                options: [
                    "Data capture and data entry",
                    "Authorising a purchase, paying the bill, and having custody of the asset",
                    "Systems analysis and programming",
                    "All of the above"
                ],
                answer: "All of the above",
                type: "single",
                explanation: "The chapter gives the example of authorizing, paying for, and having custody of an asset as duties that must be segregated. It also lists data capture/entry, computer operations, and systems analysis/programming as roles that should be separate.",
                topic: "Information security",
                isTricky: true
            },
            {
                id: 15,
                question: "A company's production department used 1,000 labour hours to produce 500 units. The budgeted cost per labour hour was £15, but the actual cost was £14.50. Achieving the lower labour cost per hour is a measure of:",
                options: [
                    "Effectiveness",
                    "Efficiency",
                    "Economy",
                    "Productivity"
                ],
                answer: "Economy",
                type: "calculation",
                explanation: "Economy is the reduction or containment of cost. By achieving a labour cost per hour (£14.50) that is lower than the budget (£15), the company has demonstrated economy.",
                topic: "Measuring performance",
                isTricky: false
            },
            {
                id: 16,
                question: "In the same scenario (1,000 labour hours to produce 500 units), what is the productivity of the labour force?",
                options: [
                    "2 units per hour",
                    "0.5 units per hour",
                    "500 units per £14.50",
                    "Cannot be determined"
                ],
                answer: "0.5 units per hour",
                type: "calculation",
                explanation: "Productivity measures output in relation to input. Here, it is the number of units produced per labour hour. Calculation: 500 units / 1,000 hours = 0.5 units per hour.",
                topic: "Measuring performance",
                isTricky: false
            },
            {
                id: 17,
                question: "An internet retailer identifies that its ________ is delivering goods to mainland UK consumers within 24 hours of an order being placed.",
                options: [
                    "Key Performance Indicator (KPI)",
                    "Core Competence",
                    "Critical Success Factor (CSF)",
                    "Strategic Objective"
                ],
                answer: "Critical Success Factor (CSF)",
                type: "fill-in-the-blank",
                explanation: "The text uses this exact example to illustrate a Critical Success Factor (CSF), which is an area where the business must perform well to succeed and achieve a competitive advantage.",
                topic: "Measuring performance",
                isTricky: false
            },
            {
                id: 18,
                question: "The Balanced Scorecard developed by Kaplan and Norton looks at the business from four important perspectives. Which of the following is NOT one of those perspectives?",
                options: [
                    "Financial",
                    "Customer",
                    "Shareholder Value",
                    "Internal Business Processes"
                ],
                answer: "Shareholder Value",
                type: "single",
                explanation: "The four perspectives are: Financial ('How do we look to our shareholders?'), Customer, Internal Business Processes, and Innovation and Learning. While the financial perspective addresses shareholders, 'Shareholder Value' itself is not one of the four named perspectives.",
                topic: "Measuring performance",
                isTricky: true
            },
            {
                id: 19,
                question: "Under the 'Customer' perspective of the Balanced Scorecard, which of the following would be an appropriate measure?",
                options: [
                    "Return on capital employed",
                    "Employee retention rates",
                    "Customer satisfaction ratings",
                    "Product failure rates"
                ],
                answer: "Customer satisfaction ratings",
                type: "single",
                explanation: "The chapter lists customer satisfaction ratings, retention rates, and return rates as examples of measures for the Customer perspective.",
                topic: "Measuring performance",
                isTricky: false
            },
            {
                id: 20,
                question: "The Task Force on Climate-related Financial Disclosures (TCFD) recommends four core areas of disclosure. These are:",
                options: [
                    "Social, Environmental, Economic, and Governance",
                    "Governance, Strategy, Risk Management, and Metrics & Targets",
                    "Financial, Manufactured, Human, and Natural Capital",
                    "Planning, Operations, Tactical, and Strategic Information"
                ],
                answer: "Governance, Strategy, Risk Management, and Metrics & Targets",
                type: "single",
                explanation: "Section 10.2.1 explicitly lists the four core areas of disclosure recommended by the TCFD as Governance, Strategy, Risk Management, and Metrics and targets.",
                topic: "Measuring climate change and sustainability",
                isTricky: false
            },
            {
                id: 21,
                question: "The Global Reporting Initiative (GRI) Standards are a global code for sustainability reporting. Which of the following would be considered a 'Social' performance issue under the GRI framework?",
                options: [
                    "Emissions levels and waste",
                    "Workers' rights and health & safety",
                    "Compliance with environmental legislation",
                    "Use of natural resources"
                ],
                answer: "Workers' rights and health & safety",
                type: "single",
                explanation: "The table in section 10.1 lists health and safety and workers' rights under the 'Social' category of the triple bottom line, which aligns with GRI's focus.",
                topic: "Measuring climate change and sustainability",
                isTricky: false
            },
            {
                id: 22,
                question: "The Integrated Reporting Framework discusses the creation or erosion of six capitals by an organisation. Which capital refers to the skills, competences and motivation of the workforce?",
                options: [
                    "Intellectual Capital",
                    "Social and Relationship Capital",
                    "Human Capital",
                    "Manufactured Capital"
                ],
                answer: "Human Capital",
                type: "single",
                explanation: "Human capital is defined as the skills, competences, and motivation of the workforce that are developed by the organisation.",
                topic: "Measuring climate change and sustainability",
                isTricky: false
            },
            {
                id: 23,
                question: "According to the COSO Internal Control – Integrated Framework, internal control is a process designed to provide ________ assurance regarding the achievement of objectives.",
                options: [
                    "absolute",
                    "complete",
                    "reasonable",
                    "guaranteed"
                ],
                answer: "reasonable",
                type: "fill-in-the-blank",
                explanation: "The definition explicitly states that internal control is designed to provide 'reasonable assurance', not absolute assurance, because of inherent limitations.",
                topic: "Internal controls",
                isTricky: false
            },
            {
                id: 24,
                question: "The COSO framework states that internal control consists of five integrated components. Which of the following are among these five components? (Select 3)",
                options: [
                    "Control Environment",
                    "Risk Assessment",
                    "Financial Reporting",
                    "Control Activities"
                ],
                answer: ["Control Environment", "Risk Assessment", "Control Activities"],
                type: "multiple",
                explanation: "The five components of the COSO framework are: Control Environment, Risk Assessment, Control Activities, Information and Communication, and Monitoring Activities. Financial Reporting is an objective category, not a component.",
                topic: "Internal controls",
                isTricky: false
            },
            {
                id: 25,
                question: "Which component of the COSO framework 'sets the tone of a business and the control consciousness of its people'?",
                options: [
                    "Risk Assessment",
                    "Monitoring Activities",
                    "Control Environment",
                    "Information and Communication"
                ],
                answer: "Control Environment",
                type: "single",
                explanation: "The Control Environment is described as the foundation for all other components of internal control, providing discipline and structure and setting the 'tone at the top'.",
                topic: "Internal controls",
                isTricky: false
            },
            // Adding more questions to reach 50
            {
                id: 26,
                question: "Which task of the finance function involves managing cash, working capital, debt, and equity finance?",
                options: ["Management accounting", "Financial reporting", "Treasury management", "Recording financial transactions"],
                answer: "Treasury management",
                type: "single",
                explanation: "Treasury management is defined as managing the funds of a business, including cash, working capital, and various forms of finance.",
                topic: "What does the finance function do?",
                isTricky: false
            },
            {
                id: 27,
                question: "Information that helps people deal with short-term issues and opportunities, such as monthly variance reports for a factory, is classified as:",
                options: ["Strategic information", "Operational information", "Planning information", "Tactical information"],
                answer: "Tactical information",
                type: "single",
                explanation: "Tactical information is used for short-term issues and opportunities, fitting the description of monthly variance reports used by factory management.",
                topic: "Uses and types of financial information",
                isTricky: false
            },
            {
                id: 28,
                question: "Which enhancing qualitative characteristic of financial information means having information available to decision-makers in time to be capable of influencing their decisions?",
                options: ["Verifiability", "Timeliness", "Comparability", "Understandability"],
                answer: "Timeliness",
                type: "single",
                explanation: "Timeliness is the characteristic that ensures information is available to users before it loses its capacity to influence decisions.",
                topic: "Qualitative characteristics of financial information",
                isTricky: false
            },
            {
                id: 29,
                question: "A Transaction Processing System (TPS) for a finance/accounting function would typically include which of the following subsystems?",
                options: ["Marketing research system", "Quality control system", "Nominal ledger and Accounts receivable/payable", "Career path systems"],
                answer: "Nominal ledger and Accounts receivable/payable",
                type: "single",
                explanation: "The table in section 7.2 shows that a finance/accounting TPS includes subsystems like nominal ledger, accounts receivable/payable, budgeting, and treasury management.",
                topic: "Information processing and management",
                isTricky: false
            },
            {
                id: 30,
                question: "A company's sales for the year were £500,000 and its net profit was £75,000. The capital employed was £1,000,000. What is the net profit margin?",
                options: ["7.5%", "50%", "15%", "10%"],
                answer: "15%",
                type: "calculation",
                explanation: "Net profit margin is calculated as (Net Profit / Revenue) * 100. So, (£75,000 / £500,000) * 100 = 15%.",
                topic: "Measuring performance",
                isTricky: false
            },
            {
                id: 31,
                question: "The 'triple bottom line' aims to measure a business's performance in three areas. What are they?",
                options: ["Profit, People, Planet", "Social, Environmental, Economic", "Financial, Operational, Strategic", "Both A and B are common interpretations"],
                answer: "Both A and B are common interpretations",
                type: "single",
                explanation: "The chapter refers to the triple bottom line by the SEE acronym: Social, Environmental, Economic. 'Profit, People, Planet' is another widely used and equivalent term for the same concept.",
                topic: "Measuring climate change and sustainability",
                isTricky: true
            },
            {
                id: 32,
                question: "According to the FRC, who has the primary responsibility for the company's system of internal control?",
                options: ["The external auditors", "The internal audit department", "The board of directors", "The finance director"],
                answer: "The board of directors",
                type: "single",
                explanation: "The FRC guidance states that the board of directors as a whole has responsibility for policy making on, reviewing the effectiveness of, and reporting on the internal control system.",
                topic: "Internal controls",
                isTricky: false
            },
            {
                id: 33,
                question: "Which of the following describes the 'confirmatory value' aspect of relevance?",
                options: [
                    "It can be used to predict future outcomes.",
                    "It provides feedback about (confirms or changes) previous evaluations.",
                    "It is free from error and bias.",
                    "It can be compared with information from other entities."
                ],
                answer: "It provides feedback about (confirms or changes) previous evaluations.",
                type: "single",
                explanation: "Information has confirmatory value if it helps users confirm or correct their past expectations or evaluations.",
                topic: "Qualitative characteristics of financial information",
                isTricky: false
            },
            {
                id: 34,
                question: "A system that performs, records, and processes routine transactions is known as a:",
                options: ["Management Information System (MIS)", "Decision Support System (DSS)", "Expert System (ES)", "Transaction Processing System (TPS)"],
                answer: "Transaction Processing System (TPS)",
                type: "single",
                explanation: "This is the definition of a Transaction Processing System (TPS), which handles the day-to-day operational transactions of a business.",
                topic: "Information processing and management",
                isTricky: false
            },
            {
                id: 35,
                question: "Which two underlying assumptions must be followed for financial information to be useful, according to the IFRS Framework?",
                options: [
                    "Materiality and Prudence",
                    "Accrual basis and Going concern",
                    "Historical cost and Neutrality",
                    "Relevance and Faithful representation"
                ],
                answer: "Accrual basis and Going concern",
                type: "single",
                explanation: "Section 5.4 states that financial information must be prepared on the basis of two underlying assumptions: the accrual basis of accounting and the business being a going concern.",
                topic: "Qualitative characteristics of financial information",
                isTricky: false
            },
            {
                id: 36,
                question: "Which of the following is an example of a 'non-financial' quantitative measure of performance?",
                options: [
                    "Gross profit margin",
                    "Number of customer complaints per month",
                    "Return on Capital Employed (ROCE)",
                    "Earnings per share (EPS)"
                ],
                answer: "Number of customer complaints per month",
                type: "single",
                explanation: "Non-financial measures are based on data not expressed in monetary terms. The number of complaints is a quantitative but non-financial metric.",
                topic: "Measuring performance",
                isTricky: false
            },
            {
                id: 37,
                question: "The establishment of targets and comparators through data gathering to identify areas of underperformance is known as:",
                options: ["Budgeting", "Forecasting", "Benchmarking", "Variance Analysis"],
                answer: "Benchmarking",
                type: "single",
                explanation: "Benchmarking is defined as the process of establishing targets and comparators by gathering data, often from best-in-class companies, to improve performance.",
                topic: "Measuring performance",
                isTricky: false
            },
            {
                id: 38,
                question: "Under the TCFD framework, a risk related to changes in regulations and exposure to litigation due to climate change is classified as what type of risk?",
                options: ["Acute physical risk", "Chronic physical risk", "Policy and legal risk", "Market risk"],
                answer: "Policy and legal risk",
                type: "single",
                explanation: "The table in section 10.2.1 categorizes risks from changing regulations and potential litigation as 'Policy and legal' risks.",
                topic: "Measuring climate change and sustainability",
                isTricky: false
            },
            {
                id: 39,
                question: "Which capital, in the Integrated Reporting Framework, refers to intellectual property and organisational knowledge?",
                options: ["Human Capital", "Manufactured Capital", "Natural Capital", "Intellectual Capital"],
                answer: "Intellectual Capital",
                type: "single",
                explanation: "Intellectual capital is defined as the intellectual property and organizational knowledge developed by the organization.",
                topic: "Measuring climate change and sustainability",
                isTricky: false
            },
            {
                id: 40,
                question: "A control activity where one person's work is checked by another is known as:",
                options: ["Authorisation", "Verification", "Reconciliation", "Segregation of duties"],
                answer: "Verification",
                type: "single",
                explanation: "Verification is a control activity that involves confirming the accuracy or truth of something, often by having a second person review the work.",
                topic: "Internal controls",
                isTricky: false
            },
            {
                id: 41,
                question: "Which user group needs financial information to assess their employer’s stability, profitability, and ability to provide remuneration and benefits?",
                options: ["Customers", "Suppliers", "Employees", "The public"],
                answer: "Employees",
                type: "single",
                explanation: "The chapter states that employees use financial information to assess the stability and profitability of their employer to gauge job security and future benefits.",
                topic: "Users of financial information",
                isTricky: false
            },
            {
                id: 42,
                question: "To be a 'faithful representation', financial information must be complete, neutral, and _______.",
                options: [
                    "relevant",
                    "timely",
                    "free from error",
                    "verifiable"
                ],
                answer: "free from error",
                type: "fill-in-the-blank",
                explanation: "The three characteristics of faithful representation are completeness, neutrality, and freedom from error.",
                topic: "Qualitative characteristics of financial information",
                isTricky: false
            },
            {
                id: 43,
                question: "Which of these is a physical access control?",
                options: [
                    "Password protection for a file",
                    "A door lock on the server room",
                    "Data encryption",
                    "A range check on data input"
                ],
                answer: "A door lock on the server room",
                type: "single",
                explanation: "Physical access controls are measures that limit physical access to assets. A door lock is a prime example. The others are logical or data-level controls.",
                topic: "Information security",
                isTricky: false
            },
            {
                id: 44,
                question: "In the Balanced Scorecard, measures related to employee retention rates and time to market for new products fall under which perspective?",
                options: ["Financial", "Customer", "Internal Business Processes", "Innovation and Learning"],
                answer: "Innovation and Learning",
                type: "single",
                explanation: "The Innovation and Learning perspective focuses on the organization's ability to improve and create value, which includes employee capabilities and innovation speed.",
                topic: "Measuring performance",
                isTricky: false
            },
            {
                id: 45,
                question: "A company's objective is to achieve its target profit. This is a measure of:",
                options: ["Economy", "Efficiency", "Effectiveness", "Productivity"],
                answer: "Effectiveness",
                type: "single",
                explanation: "Effectiveness is the measure of achievement and is assessed by reference to objectives. Attaining the target profit means the company has been effective in meeting that specific objective.",
                topic: "Measuring performance",
                isTricky: true
            },
            {
                id: 46,
                question: "Which body was set up by the IFRS foundation in November 2021 to deliver a global baseline of sustainability-related disclosure standards?",
                options: ["Global Reporting Initiative (GRI)", "Task Force on Climate-related Financial Disclosures (TCFD)", "International Sustainability Standards Board (ISSB)", "Natural Capital Coalition"],
                answer: "International Sustainability Standards Board (ISSB)",
                type: "single",
                explanation: "The International Sustainability Standards Board (ISSB) was established in November 2021 by the IFRS Foundation with the goal of creating comprehensive global sustainability disclosure standards.",
                topic: "Measuring climate change and sustainability",
                isTricky: false
            },
            {
                id: 47,
                question: "Which component of the COSO framework involves ongoing or separate evaluations to ascertain whether each of the five components of internal control is present and functioning?",
                options: ["Risk Assessment", "Control Activities", "Monitoring Activities", "Control Environment"],
                answer: "Monitoring Activities",
                type: "single",
                explanation: "Monitoring Activities are defined as the process of assessing the quality and effectiveness of the internal control system's performance over time.",
                topic: "Internal controls",
                isTricky: false
            },
            {
                id: 48,
                question: "The process of taking unprocessed data and converting it into useful management information is called:",
                options: ["Data storage", "Information security", "Information processing", "Data validation"],
                answer: "Information processing",
                type: "single",
                explanation: "Information processing is defined as the conversion of collected data into information for communication and use within the business.",
                topic: "Information processing and management",
                isTricky: false
            },
            {
                id: 49,
                question: "A company's ability to adapt to changes in the environment in which it operates is known as its:",
                options: ["Liquidity", "Solvency", "Profitability", "Adaptability"],
                answer: "Adaptability",
                type: "single",
                explanation: "The table in section 5.4.1 defines adaptability as the capacity to adapt to environmental changes.",
                topic: "Users of financial information",
                isTricky: false
            },
            {
                id: 50,
                question: "Which of the following is an example of a 'control activity' within the COSO framework?",
                options: [
                    "Setting a 'tone at the top' for ethical behavior",
                    "Identifying potential risks to business objectives",
                    "Performing a bank reconciliation",
                    "Communicating financial results to shareholders"
                ],
                answer: "Performing a bank reconciliation",
                type: "single",
                explanation: "Reconciliation is explicitly listed as a type of control activity. Setting the tone is part of the Control Environment, identifying risks is Risk Assessment, and communicating results is part of Information & Communication.",
                topic: "Internal controls",
                isTricky: false
            }
        ];

        // --- DOM ELEMENTS ---
        const homePage = document.getElementById('home-page');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const questionTracker = document.getElementById('question-tracker');
        const questionNumberEl = document.getElementById('question-number');
        const timerEl = document.getElementById('timer');
        const flagBtn = document.getElementById('flag-btn');
        const questionTextEl = document.getElementById('question-text');
        const questionTypeInfoEl = document.getElementById('question-type-info');
        const optionsContainer = document.getElementById('options-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitBtn = document.getElementById('submit-btn');
        
        // Results screen elements
        const scorePercentageEl = document.getElementById('score-percentage');
        const correctAnswersEl = document.getElementById('correct-answers');
        const incorrectAnswersEl = document.getElementById('incorrect-answers');
        const topicsToReviewEl = document.getElementById('topics-to-review');
        const chapterCoverageEl = document.getElementById('chapter-coverage');
        const xpGainedEl = document.getElementById('xp-gained');
        const userLevelEl = document.getElementById('user-level');
        const detailedReviewEl = document.getElementById('detailed-review');
        const retakeQuizBtn = document.getElementById('retake-quiz-btn');

        // Review filter buttons
        const reviewAllBtn = document.getElementById('review-all-btn');
        const reviewCorrectBtn = document.getElementById('review-correct-btn');
        const reviewIncorrectBtn = document.getElementById('review-incorrect-btn');
        const reviewFlaggedBtn = document.getElementById('review-flagged-btn');

        // Modal elements
        const confirmationModal = document.getElementById('confirmation-modal');
        const modalTextEl = document.getElementById('modal-text');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');

        // --- QUIZ STATE ---
        let currentQuestionIndex = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let flaggedQuestions = [];
        let timerInterval;
        let timeLeft = 45 * 60; // 45 minutes in seconds

        // --- INITIALIZATION ---
        function init() {
            startQuizBtn.addEventListener('click', startQuiz);
            nextBtn.addEventListener('click', nextQuestion);
            prevBtn.addEventListener('click', prevQuestion);
            submitBtn.addEventListener('click', () => showConfirmationModal('submit'));
            flagBtn.addEventListener('click', toggleFlag);
            retakeQuizBtn.addEventListener('click', () => {
                // Using a simple page reload for a full reset
                window.location.reload();
            });

            reviewAllBtn.addEventListener('click', () => filterReview('all'));
            reviewCorrectBtn.addEventListener('click', () => filterReview('correct'));
            reviewIncorrectBtn.addEventListener('click', () => filterReview('incorrect'));
            reviewFlaggedBtn.addEventListener('click', () => filterReview('flagged'));
        }

        // --- QUIZ FLOW FUNCTIONS ---
        function startQuiz() {
            homePage.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            resetQuizState();
            createQuestionTracker();
            loadQuestion(currentQuestionIndex);
            startTimer();
        }

        function resetQuizState() {
            currentQuestionIndex = 0;
            userAnswers.fill(null);
            flaggedQuestions = [];
            timeLeft = 45 * 60;
        }

        function loadQuestion(index) {
            currentQuestionIndex = index;
            const question = quizData[index];

            questionNumberEl.textContent = index + 1;
            questionTextEl.innerHTML = question.question; // Use innerHTML to render potential formatting like bold/italics
            optionsContainer.innerHTML = '';
            
            // Display question type info
            if (question.type === 'multiple') {
                questionTypeInfoEl.textContent = 'ℹ️ Select all that apply.';
                questionTypeInfoEl.classList.remove('hidden');
            } else if (question.type === 'fill-in-the-blank') {
                questionTypeInfoEl.textContent = 'ℹ️ Select the best option to fill in the blank.';
                questionTypeInfoEl.classList.remove('hidden');
            } else {
                questionTypeInfoEl.classList.add('hidden');
            }


            // Create options
            question.options.forEach(optionText => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('p-4', 'border', 'rounded-lg', 'cursor-pointer', 'hover:bg-blue-50', 'hover:border-blue-300', 'transition-colors');
                
                if (question.type === 'multiple') {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'option';
                    checkbox.value = optionText;
                    checkbox.classList.add('mr-3', 'transform', 'scale-125');
                    checkbox.addEventListener('change', () => handleMultipleChoiceSelection(question));
                    
                    const label = document.createElement('label');
                    label.appendChild(checkbox);
                    label.append(optionText);
                    label.classList.add('flex', 'items-center', 'w-full');
                    optionElement.appendChild(label);
                    
                    // Check if this option was previously selected
                    if (Array.isArray(userAnswers[index]) && userAnswers[index].includes(optionText)) {
                        checkbox.checked = true;
                        optionElement.classList.add('bg-blue-100', 'border-blue-400');
                    }

                } else { // single or fill-in-the-blank
                    optionElement.textContent = optionText;
                    optionElement.addEventListener('click', () => selectAnswer(optionText, question.type));
                    
                    // Highlight selected answer
                    if (userAnswers[index] === optionText) {
                        optionElement.classList.add('bg-blue-100', 'border-blue-400');
                    }
                }
                optionsContainer.appendChild(optionElement);
            });

            updateNavigationButtons();
            updateQuestionTracker();
            updateFlagButton();
        }
        
        function selectAnswer(selectedOption, type) {
            userAnswers[currentQuestionIndex] = selectedOption;
            loadQuestion(currentQuestionIndex); // Reload to show selection
        }

        function handleMultipleChoiceSelection(question) {
            const selectedCheckboxes = optionsContainer.querySelectorAll('input[type="checkbox"]:checked');
            const selectedValues = Array.from(selectedCheckboxes).map(cb => cb.value);
            userAnswers[currentQuestionIndex] = selectedValues.length > 0 ? selectedValues : null;
            loadQuestion(currentQuestionIndex); // Reload to show selections
        }

        function createQuestionTracker() {
            questionTracker.innerHTML = '';
            quizData.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.textContent = index + 1;
                btn.classList.add('question-tracker-btn');
                btn.addEventListener('click', () => loadQuestion(index));
                questionTracker.appendChild(btn);
            });
        }

        function updateQuestionTracker() {
            const buttons = questionTracker.children;
            for (let i = 0; i < buttons.length; i++) {
                buttons[i].className = 'question-tracker-btn'; // Reset classes
                if (flaggedQuestions.includes(i)) {
                    buttons[i].classList.add('qt-flagged');
                } else if (userAnswers[i] !== null) {
                    buttons[i].classList.add('qt-attempted');
                } else {
                    buttons[i].classList.add('qt-unattempted');
                }

                if (i === currentQuestionIndex) {
                    buttons[i].classList.add('qt-current');
                }
            }
        }
        
        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            prevBtn.classList.toggle('opacity-50', currentQuestionIndex === 0);

            if (currentQuestionIndex === quizData.length - 1) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                loadQuestion(currentQuestionIndex - 1);
            }
        }

        function toggleFlag() {
            const index = flaggedQuestions.indexOf(currentQuestionIndex);
            if (index > -1) {
                flaggedQuestions.splice(index, 1);
            } else {
                flaggedQuestions.push(currentQuestionIndex);
            }
            updateFlagButton();
            updateQuestionTracker();
        }

        function updateFlagButton() {
            if (flaggedQuestions.includes(currentQuestionIndex)) {
                flagBtn.innerHTML = '<i class="fas fa-flag"></i> Unflag';
                flagBtn.classList.add('bg-red-500', 'text-white');
                flagBtn.classList.remove('bg-orange-100', 'text-orange-600');
            } else {
                flagBtn.innerHTML = '<i class="fas fa-flag"></i> Flag This Question';
                flagBtn.classList.remove('bg-red-500', 'text-white');
                flagBtn.classList.add('bg-orange-100', 'text-orange-600');
            }
        }

        // --- TIMER FUNCTIONS ---
        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            if (timeLeft < 60) {
                timerEl.classList.add('text-red-500');
            }
        }

        // --- SUBMISSION AND RESULTS ---
        function submitQuiz() {
            clearInterval(timerInterval);
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            calculateAndDisplayResults();
        }

        function calculateAndDisplayResults() {
            let correctCount = 0;
            const incorrectTopics = new Set();

            quizData.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const correctAnswer = question.answer;
                let isCorrect = false;

                if (question.type === 'multiple') {
                    if (Array.isArray(userAnswer) && Array.isArray(correctAnswer)) {
                        isCorrect = userAnswer.length === correctAnswer.length && userAnswer.every(val => correctAnswer.includes(val));
                    }
                } else {
                    isCorrect = userAnswer === correctAnswer;
                }

                if (isCorrect) {
                    correctCount++;
                } else {
                    incorrectTopics.add(question.topic);
                }
            });

            const incorrectCount = quizData.length - correctCount;
            const scorePercentage = Math.round((correctCount / quizData.length) * 100);

            // Display summary
            scorePercentageEl.textContent = `${scorePercentage}%`;
            correctAnswersEl.textContent = correctCount;
            incorrectAnswersEl.textContent = incorrectCount;
            
            // Display topics to review
            topicsToReviewEl.innerHTML = '';
            if (incorrectTopics.size > 0) {
                incorrectTopics.forEach(topic => {
                    const li = document.createElement('li');
                    li.textContent = topic;
                    topicsToReviewEl.appendChild(li);
                });
            } else {
                topicsToReviewEl.innerHTML = '<li>Congratulations! No specific topics need review.</li>';
            }

            // Display performance & gamification
            const xp = correctCount * 10;
            xpGainedEl.textContent = `${xp} XP`;
            if (scorePercentage >= 90) userLevelEl.textContent = 'Expert 🎓';
            else if (scorePercentage >= 75) userLevelEl.textContent = 'Prodigy 🧠';
            else if (scorePercentage >= 50) userLevelEl.textContent = 'Learner 👍';
            else userLevelEl.textContent = 'Beginner 🌱';

            // Chapter coverage
            const uniqueTopics = new Set(quizData.map(q => q.topic));
            chapterCoverageEl.textContent = `~${Math.round((uniqueTopics.size / 11) * 100)}%`; // Based on 11 topics in PDF

            // Display detailed review
            displayDetailedReview();
            filterReview('all'); // Initially show all
        }

        function displayDetailedReview() {
            detailedReviewEl.innerHTML = '';
            quizData.forEach((question, index) => {
                const reviewItem = document.createElement('div');
                reviewItem.classList.add('p-4', 'border', 'rounded-lg', 'bg-gray-50');
                reviewItem.dataset.questionIndex = index;

                const questionHeader = document.createElement('h4');
                questionHeader.classList.add('font-bold', 'mb-2');
                let questionStatusIcon = '';
                const isCorrect = isAnswerCorrect(index);
                
                if (isCorrect) {
                    questionStatusIcon = '<i class="fas fa-check-circle text-green-500 mr-2"></i>';
                    reviewItem.dataset.result = 'correct';
                } else {
                    questionStatusIcon = '<i class="fas fa-times-circle text-red-500 mr-2"></i>';
                    reviewItem.dataset.result = 'incorrect';
                }

                if (flaggedQuestions.includes(index)) {
                     questionStatusIcon += '<i class="fas fa-flag text-orange-500 ml-2"></i>';
                     reviewItem.dataset.flagged = 'true';
                }
                
                if (question.isTricky) {
                    questionStatusIcon += '<span class="text-xs font-semibold bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full ml-2">⚠ Tricky</span>';
                }


                questionHeader.innerHTML = `${questionStatusIcon} Question ${index + 1}: ${question.question}`;
                
                const optionsList = document.createElement('div');
                optionsList.classList.add('space-y-2', 'mt-3');

                question.options.forEach(optionText => {
                    const optionDiv = document.createElement('div');
                    optionDiv.classList.add('p-2', 'rounded-md', 'border');
                    optionDiv.textContent = optionText;

                    const userAnswer = userAnswers[index];
                    const correctAnswer = question.answer;

                    if (question.type === 'multiple') {
                        if (correctAnswer.includes(optionText)) {
                            optionDiv.classList.add('correct-answer');
                        }
                        if (Array.isArray(userAnswer) && userAnswer.includes(optionText) && !correctAnswer.includes(optionText)) {
                            optionDiv.classList.add('incorrect-answer');
                        }
                    } else {
                        if (optionText === correctAnswer) {
                            optionDiv.classList.add('correct-answer');
                        } else if (optionText === userAnswer) {
                            optionDiv.classList.add('incorrect-answer');
                        }
                    }
                    optionsList.appendChild(optionDiv);
                });

                const explanation = document.createElement('div');
                explanation.classList.add('mt-3', 'p-3', 'bg-blue-50', 'border-l-4', 'border-blue-500', 'text-sm');
                explanation.innerHTML = `<strong>Explanation:</strong> ${question.explanation}`;

                reviewItem.appendChild(questionHeader);
                reviewItem.appendChild(optionsList);
                reviewItem.appendChild(explanation);
                detailedReviewEl.appendChild(reviewItem);
            });
        }

        function isAnswerCorrect(index) {
            const question = quizData[index];
            const userAnswer = userAnswers[index];
            const correctAnswer = question.answer;
            if (question.type === 'multiple') {
                return Array.isArray(userAnswer) && Array.isArray(correctAnswer) && userAnswer.length === correctAnswer.length && userAnswer.every(val => correctAnswer.includes(val));
            }
            return userAnswer === correctAnswer;
        }

        function filterReview(filterType) {
            const allItems = detailedReviewEl.querySelectorAll('[data-question-index]');
            allItems.forEach(item => {
                let show = false;
                switch(filterType) {
                    case 'all':
                        show = true;
                        break;
                    case 'correct':
                        show = item.dataset.result === 'correct';
                        break;
                    case 'incorrect':
                        show = item.dataset.result === 'incorrect';
                        break;
                    case 'flagged':
                        show = item.dataset.flagged === 'true';
                        break;
                }
                item.style.display = show ? 'block' : 'none';
            });
            
            // Update active button style
            [reviewAllBtn, reviewCorrectBtn, reviewIncorrectBtn, reviewFlaggedBtn].forEach(btn => btn.classList.remove('bg-blue-500', 'text-white'));
            document.getElementById(`review-${filterType}-btn`).classList.add('bg-blue-500', 'text-white');

        }

        // --- MODAL ---
        function showConfirmationModal(action) {
            if (action === 'submit') {
                modalTextEl.textContent = 'Do you really want to submit your quiz? Any unanswered questions will be marked as incorrect.';
                modalConfirmBtn.onclick = () => {
                    hideConfirmationModal();
                    submitQuiz();
                };
            }
            confirmationModal.classList.remove('hidden');
        }

        function hideConfirmationModal() {
            confirmationModal.classList.add('hidden');
        }

        modalCancelBtn.addEventListener('click', hideConfirmationModal);
        
        // --- KICK OFF THE APP ---
        init();

    </script>
</body>
</html>
